<!DOCTYPE html>

<html lang="ko-KR">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="format-detection" content="telephone=no"/>

    <title>Smart Tiger&#39;s blog</title>
    
    <link rel="apple-touch-icon" sizes="180x180" href="https://eoriented.github.io/apple-touch-icon.png">
    
    
    <link rel="icon" type="image/png" sizes="16x16" href="https://eoriented.github.io/favicon.ico">
    <link rel="manifest" href="https://eoriented.github.io/manifest.json">
    <link rel="mask-icon" href="https://eoriented.github.io/safari-pinned-tab.svg" color="#FF3DB4">
    <meta name="theme-color" content="#ffffff">

    
    
    
    <link rel="stylesheet" href="https://eoriented.github.io/css/main.min.832f51bd8886edde2e4bd3034bec7fb7bb6766151b4f7c83987458ed1481c80f.css"/>

    
    
    

    
    
 
    
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-160052384-1', 'auto');
	
	ga('send', 'pageview');
}
</script>


    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
  });
  MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script> 
</head>
    <body>
        
<nav>
  <header>
    <div class="site-title">
        
        <a href="https://eoriented.github.io/">
        <img style="display: block; margin: 0px auto" width="90%" src="https://eoriented.github.io/images/logo2.png" /></a>
    </div>  
</header>
  <div class="nav-menu">
  
    <a class="color-link nav-link" href="https://eoriented.github.io/categories/bigdata/">Big data</a>
  
    <a class="color-link nav-link" href="https://eoriented.github.io/categories/machine-learning/">Machine learning</a>
  
    <a class="color-link nav-link" href="https://eoriented.github.io/categories/programming/">Programming</a>
  
    <a class="color-link nav-link" href="https://eoriented.github.io/categories/cloud/">Cloud</a>
  
    <a class="color-link nav-link" href="https://eoriented.github.io/categories/tools/">Tools</a>
  
    <a class="color-link nav-link" href="https://eoriented.github.io/categories/">Categories</a>
  
    <a class="color-link nav-link" href="https://eoriented.github.io/tags/">Tags</a>
  
  
</div>
<footer class="footer">
	<div class="social-icons" style="text-align: center">
    
    <a class="social-icon" href="https://github.com/eoriented" target="_blank" rel="noopener" title="GitHub">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M13.9988029,1.32087331 C6.82105037,1.32087331 1,7.14112562 1,14.3212723 C1,20.0649109 4.72454649,24.9370678 9.89038951,26.6560892 C10.5408085,26.7757983 10.7778323,26.374374 10.7778323,26.0296121 C10.7778323,25.7215609 10.7666595,24.9035493 10.760275,23.8189856 C7.14426471,24.6042767 6.38131925,22.0760223 6.38131925,22.0760223 C5.78995672,20.5740732 4.93762853,20.1742451 4.93762853,20.1742451 C3.75729765,19.3682044 5.02701126,19.3841656 5.02701126,19.3841656 C6.33183953,19.4759425 7.01817121,20.7241085 7.01817121,20.7241085 C8.17775254,22.7104801 10.0611744,22.1366749 10.8017741,21.8038838 C10.919887,20.9643246 11.2558703,20.3913175 11.6269683,20.066507 C8.74038491,19.7385043 5.70536235,18.6228163 5.70536235,13.6413251 C5.70536235,12.2223743 6.21213051,11.0611968 7.04370914,10.1530044 C6.90963504,9.82420367 6.46351945,8.50181809 7.17139875,6.71256734 C7.17139875,6.71256734 8.26234691,6.36301702 10.7459099,8.04532771 C11.78259,7.75642995 12.8950858,7.61277914 14.000399,7.60719272 C15.1049142,7.61277914 16.2166119,7.75642995 17.2548881,8.04532771 C19.736855,6.36301702 20.8262071,6.71256734 20.8262071,6.71256734 C21.5356825,8.50181809 21.0895669,9.82420367 20.9562909,10.1530044 C21.7894656,11.0611968 22.2922435,12.2223743 22.2922435,13.6413251 C22.2922435,18.6355852 19.2524325,19.734514 16.3570705,20.0561322 C16.8231376,20.4575564 17.2389269,21.2508282 17.2389269,22.4638795 C17.2389269,24.2012564 17.2229657,25.603448 17.2229657,26.0296121 C17.2229657,26.3775663 17.4575954,26.7821827 18.116793,26.6552912 C23.2786458,24.9322794 27,20.0633148 27,14.3212723 C27,7.14112562 21.1789496,1.32087331 13.9988029,1.32087331"></path>
        </svg>
    </a>
    

    

    
    <a class="social-icon" href="mailto:eoriented@gmail.com" target="_blank" rel="noopener" title="Email">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M25.2794292,5.59128519 L14,16.8707144 L2.72057081,5.59128519 C3.06733103,5.30237414 3.51336915,5.12857603 4,5.12857603 L24,5.12857603 C24.4866308,5.12857603 24.932669,5.30237414 25.2794292,5.59128519 Z M25.9956978,6.99633695 C25.998551,7.04004843 26,7.08414302 26,7.12857603 L26,20.871424 C26,21.0798433 25.9681197,21.2808166 25.9089697,21.4697335 L18.7156355,14.2763993 L25.9956978,6.99633695 Z M24.9498374,22.6319215 C24.6672737,22.7846939 24.3437653,22.871424 24,22.871424 L4,22.871424 C3.5268522,22.871424 3.09207889,22.7071233 2.74962118,22.432463 L10.0950247,15.0870594 L13.9848068,18.9768415 L14.1878486,18.7737996 L14.2030419,18.7889929 L17.6549753,15.3370594 L24.9498374,22.6319215 Z M2.00810114,21.0526627 C2.00273908,20.9929669 2,20.9325153 2,20.871424 L2,7.12857603 C2,7.08414302 2.00144896,7.04004843 2.00430222,6.99633695 L9.03436454,14.0263993 L2.00810114,21.0526627 Z"></path>
        </svg>
    </a>
    

    
    <a class="social-icon" href="https://eoriented.github.io/index.xml" target="_blank" rel="noopener" type="application/rss+xml" title="Rss">
        <svg width="28px" height="28px" viewBox="0 0 8 8" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <circle xmlns="http://www.w3.org/2000/svg" class="symbol" cx="2" cy="6" r="1"/>
            <path xmlns="http://www.w3.org/2000/svg" class="symbol" d="m 1,4 a 3,3 0 0 1 3,3 h 1 a 4,4 0 0 0 -4,-4 z"/>
            <path xmlns="http://www.w3.org/2000/svg" class="symbol" d="m 1,2 a 5,5 0 0 1 5,5 h 1 a 6,6 0 0 0 -6,-6 z"/>
        </svg>
    </a>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    
    

    
</div>




	
	

	<script src="https://eoriented.github.io/js/main.min.fa5c2b23e07b5d9bfad267a52b4b24fdb053e6fb7524993383594926a3ac270c.js" integrity="sha256-+lwrI+B7XZv60melK0sk/bBT5vt1JJkzg1lJJqOsJww="></script>
</footer>
</nav>
        <div id="content" class="content-container">
        
<h1 class="post-title">저장소(Storage)와 검색(Retrieval) - 1</h1>
    
    <div>
        <p>
        <p><a href="https://eoriented.github.io/post/data-models-and-query-languages-2/">이전 포스트</a>에서는 데이터 모델과 질의 언어에 대해 알아보았습니다. 예를 들어 애플리케이션 개발자 관점에서 데이터베이스에 저장하는 데이터 포맷과 데이터를 다시 요청하는 메커니즘과 같은 것들을 살펴보았습니다. 이번 장에서는 데이터베이스 관점에서 데이터를 저장하는 방법과 데이터를 요청했을 때 다시 찾을 수 있는 방법에 대해서 살펴볼 예정입니다.</p>
<p>일반적으로 애플리케이션 개발자는 처음부터 자신의 저장소 엔진을 구현하기 보다는 사용가능한 저장소 엔진 중에 애플리케이션 요구사항에 적합한 데이터 모델을 처리할 수 있는 저장소 엔진을 선택합니다. 특정 작업부하(workload) 유형에서 좋은 성능을 내도록 저장소 엔진을 조정하려면 어느 정도 저장소 엔진의 내부적인 이해가 필요합니다. 일반적으로 트랜잭션 작업 부하에 최적화된 저장소 엔진과 분석을 위해 최적화된 엔진간의 큰 차이가 있습니다. 또한 익숙한 데이터베이스 종류인 관계형 데이터베이스와 NoSQL이라고 불리는 데이터베이스에 사용되는 저장소 엔진에 대해서 살펴볼 예정입니다. 그리고 로그 구조(log-structured) 계열 저장소 엔진과 B-tree와 같은 페이지 지향(page-oriented) 계열 저장소에 대해서도 살펴보겠습니다.</p>
<h2 id="데이터베이스를-강력하게-만드는-데이터-구조">데이터베이스를 강력하게 만드는 데이터 구조</h2>
<p>가장 간단한 데이터베이스를 만들어보겠습니다. 이 데이터베이스는 2개의 bash 함수로 구현합니다.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#007020">#!/bin/bash
</span><span style="color:#007020"></span>db_set <span style="color:#666">()</span> <span style="color:#666">{</span>
    <span style="color:#007020">echo</span> <span style="color:#4070a0">&#34;</span><span style="color:#bb60d5">$1</span><span style="color:#4070a0">,</span><span style="color:#bb60d5">$2</span><span style="color:#4070a0">&#34;</span> &gt;&gt; database
<span style="color:#666">}</span>

db_get <span style="color:#666">()</span> <span style="color:#666">{</span>
    grep <span style="color:#4070a0">&#34;^</span><span style="color:#bb60d5">$1</span><span style="color:#4070a0">,&#34;</span> database | sed -e <span style="color:#4070a0">&#34;s/^</span><span style="color:#bb60d5">$1</span><span style="color:#4070a0">,//&#34;</span> | tail -n <span style="color:#40a070">1</span>
<span style="color:#666">}</span>
</code></pre></div><p>key-value 저장소를 함수 두 개로 구현하였습니다.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">db_set key value
</code></pre></div><p><code>db_set</code>를 호출하면 데이터베이스에 key, value를 저장합니다. <code>db_get key</code>를 호출하면 해당 키의 가장 최근 값을 찾아 반환합니다. 그럼 이 데이터베이스의 사용 예는 다음과 같습니다.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ db_set <span style="color:#40a070">123456</span> <span style="color:#4070a0">&#39;{&#34;name&#34;:&#34;London&#34;,&#34;attractions&#34;:[&#34;Big Ben&#34;,&#34;London Eye&#34;]}&#39;</span>

$ db_set <span style="color:#40a070">42</span> <span style="color:#4070a0">&#39;{&#34;name&#34;:&#34;San Francisco&#34;,&#34;attractions&#34;:[&#34;Golden Gate Bridge&#34;]}&#39;</span>

$ db_get <span style="color:#40a070">42</span>
<span style="color:#666">{</span><span style="color:#4070a0">&#34;name&#34;</span>:<span style="color:#4070a0">&#34;San Francisco&#34;</span>,<span style="color:#4070a0">&#34;attractions&#34;</span>:<span style="color:#666">[</span><span style="color:#4070a0">&#34;Golden Gate Bridge&#34;</span><span style="color:#666">]}</span>
</code></pre></div><p>저장 포맷은 매우 간단합니다. 한 라인에 쉼표로 구분하여 key-value를 저장하는 텍스트 파일입니다. <code>db_set</code>은 호출할 때마다 파일 끝에 key-value를 추가합니다. 파일을 끝에 추가하므로 여러번 갱신해도 이전 버전을 덮어쓰지 않습니다. 최신 데이터를 찾기 위해서는 파일에서 키의 마지막 항목을 살펴 봐야합니다. 그래서 위의 <code>db_get</code>에서 <code>tail -n 1</code>을 실행합니다. 키 값이 42인 데이터를 하나 더 추가 후 데이터를 가져오고, 데이터베이스 파일에 저장된 값을 살펴보도록 하겠습니다.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ db_set <span style="color:#40a070">42</span> <span style="color:#4070a0">&#39;{&#34;name&#34;:&#34;San Francisco&#34;,&#34;attractions&#34;:[&#34;Exploratorium&#34;]}&#39;</span>

$ db_get <span style="color:#40a070">42</span>
<span style="color:#666">{</span><span style="color:#4070a0">&#34;name&#34;</span>:<span style="color:#4070a0">&#34;San Francisco&#34;</span>,<span style="color:#4070a0">&#34;attractions&#34;</span>:<span style="color:#666">[</span><span style="color:#4070a0">&#34;Exploratorium&#34;</span><span style="color:#666">]}</span>

$ cat database
123456,<span style="color:#666">{</span><span style="color:#4070a0">&#34;name&#34;</span>:<span style="color:#4070a0">&#34;London&#34;</span>,<span style="color:#4070a0">&#34;attractions&#34;</span>:<span style="color:#666">[</span><span style="color:#4070a0">&#34;Big Ben&#34;</span>,<span style="color:#4070a0">&#34;London Eye&#34;</span><span style="color:#666">]}</span>
42,<span style="color:#666">{</span><span style="color:#4070a0">&#34;name&#34;</span>:<span style="color:#4070a0">&#34;San Francisco&#34;</span>,<span style="color:#4070a0">&#34;attractions&#34;</span>:<span style="color:#666">[</span><span style="color:#4070a0">&#34;Golden Gate Bridge&#34;</span><span style="color:#666">]}</span>
42,<span style="color:#666">{</span><span style="color:#4070a0">&#34;name&#34;</span>:<span style="color:#4070a0">&#34;San Francisco&#34;</span>,<span style="color:#4070a0">&#34;attractions&#34;</span>:<span style="color:#666">[</span><span style="color:#4070a0">&#34;Exploratorium&#34;</span><span style="color:#666">]}</span>
</code></pre></div><p><code>db_get</code> 함수에서는 가장 최근에 넣은 값이 나오는 것을 알 수 있습니다. 위와 같이 <code>db_set</code> 함수를 사용하여 데이터를 추가하는 경우 파일을 추가 하는 일입니다. 이렇게 파일 추가 작업은 매우 효율적이기 때문에 실제로 꽤 좋은 성능을 보여줍니다. 그래서 많은 데이터베이스는 내부적으로 append-only 데이터 파일인 로그를 사용하고 있습니다. 실제 데이터베이스에선 위와 같이 간단하게 로그를 사용하진 않습니다. 예를 들어 로그에 대한 동시성 제어, 로그가 계속 커지지 않게끔 하는 처리, 오류 처리, 부분적으로 기록된 레코드 처리 등과 같은 것들이 있습니다. 그러나 로그의 기본 원리는 같습니다. 이와 같이 로그는 굉장히 유용합니다.</p>
<p>반면에 <code>db_get</code> 함수는 데이터베이스에 많은 레코드들이 있으면 성능이 매우 좋지 않습니다. 왜냐하면 키가 있는지 찾기 위해 매번 데이터베이스 파일을 full scan 해야 합니다. 검색 비용이 O(n)입니다. 즉, 데이터베이스의 레코드 수가 2배 늘면 찾는데도 2배 오래 걸립니다. 그래서 데이터베이스에서는 특정 키 값을 효율적으로 찾기 위해서 다른 자료구조가 필요합니다. 그래서 사용하는 자료구조는 바로 색인입니다.</p>
<p>색인은 일반적으로 부가적인 메타데이터를 유지하는 것입니다. 이 메타데이터를 통해 빠르게 원하는 데이터의 위치를 찾는 것이죠. 이러한 색인은 원래 데이터로부터 추가적으로 생성한 자료구조입니다. 이와 같은 추가적인 자료구조이므로 데이터를 쓰는 과정에서 추가적인 오버헤드가 생깁니다. 즉, 색인은 쓰기 속도를 느리게 만드는 대신 읽기를 빠르게 하는 역할을 하는 것입니다. 이것은 저장소 시스템에서 중요한 트레이드 오프입니다. 그렇기 때문에 애플리케이션 개발자는 애플리케이션에서 자주 사용하는 질의 패턴에 대해서 직접 색인을 선택해야 합니다. 그래야 필요 이상으로 오버헤드를 발생시키지 않으면서 애플리케이션에 이익을 가져다줄 수 있습니다.</p>
<h2 id="해시-색인hash-index">해시 색인(Hash Index)</h2>
<p>디스크 상의 데이터를 색인하기 위해 인메모리 데이터 구조인 해시 맵을 사용하는 예를 살펴보도록 하겠습니다. 앞의 예제와 같이 단순히 파일에 추가하는 방식으로 데이터 저장소를 구성하는 경우 가장 간단한 색인 전략은 키를 데이터베이스 파일의 바이트 오프셋에 매핑해 인메모리 해시 맵에 유지하는 것입니다.</p>
<figure >
<a href="https://notes.shichao.io/dda/ch3/" target="_blank">
  <img src="https://eoriented.github.io/images/storage-and-retrieval-1/hash-index.png" width="100%"  style="max-width: 600px" />
  </a>

</figure>
<p>바이트 오프셋은 위의 그림과 같이 키를 통해 바로 값을 찾을 수 있습니다. 파일에 새로운 key-value 쌍이 추가될 때마다 해시 맵도 갱신해야 합니다.</p>
<p>지금까지 설명한 것과 같이 계속 파일에 추가만 하는 경우 디스크 공간이 부족해집니다. 이러한 문제를 해결하는 방법으로 특정 크기의 세그먼트로 로그를 나누는 것입니다. 즉, 파일이 특정 크기에 도달하면 세그먼트 파일을 닫고 새로운 세그먼트 파일에 추가를 하는 것입니다. 이러면 각각의 파일에 대해 컴팩션(compaction)을 수행할 수 있습니다. 컴팩션은 각 로그의 중복된 키 값을 버리고 각 키의 최신 값만 유지하는 것을 의미합니다. 이러한 세그먼트 파일은 변경할 수 없기 때문에 컴팩션을 통한 병합된 세그먼트는 새로운 파일로 만듭니다. 컴팩션의 경우 백그라운드 스레드에서 수행이 되며, 컴팩션을 수행하는 동안에도 사용자의 읽기나 쓰기 요청도 정상적으로 처리할 수 있습니다. 병합이 완료되면 새로 병합한 세그먼트를 사용하도록 전환하고 전환 후에는 이전 세그먼트 파일을 삭제합니다. 다음 그림은 컴팩션과 병합을 수행하는 과정을 나타낸 그림입니다.</p>
<figure >
<a href="https://notes.shichao.io/dda/ch3/" target="_blank">
  <img src="https://eoriented.github.io/images/storage-and-retrieval-1/segment-log.png" width="100%"  style="max-width: 600px" />
  </a>

</figure>
<p>위와 같은 형태로 세그먼트로 나누어 파일의 저장하는 경우 각 세그먼트 파일별로 인메모리 해시 테이블을 갖습니다. 그래서 키의 값을 찾으려면 최신 세그먼트 해시 맵을 확인하고 없으면 두 번째 최신 세그먼트의 확인이 필요합니다. 병합을 통해 세그먼트 수가 적게 유지되기 때문에 조회를 위해 많은 해시 맵을 확인할 필요가 없습니다. 사실 이와 같은 데이터 저장소를 실제로 구현하려면 더 많은 사항을 고려해야 합니다. 실제 구현에서는 다음과 같은 사항을 고려해야 합니다.</p>
<ul>
<li>파일 포맷
<ul>
<li>앞선 예에서와 같이 CSV는 로그에 적합한 파일 포맷이 아닙니다. 먼저 문자열의 길이를 바이트 단위로 인코딩한 다음 원시 문자열이 오는 바이너리 포맷이 더 빠르고 간단합니다.</li>
</ul>
</li>
<li>레코드 삭제
<ul>
<li>키와 값을 삭제하려면 특수한 삭제 레코드(툼스톤이라고 불리는)를 추가해야 합니다. 세그먼트가 병합될 때 툼스톤은 병합 과정에서 삭제된 키의 이전 값을 무시합니다.</li>
</ul>
</li>
<li>고장 복구
<ul>
<li>데이터베이스가 재시작되면 인메모리 해시 맵은 손실됩니다. 원칙적으로는 전체 세그먼트 파일을 처음부터 끝까지 읽고 각 키에 대한 최신 값의 오프셋을 확인해서 해시 맵을 복원할 수 있습니다. 그러나 이 방법은 세그먼트 파일이 크면 해시 맵 복원이 오래 걸리는 문제가 있습니다. 해시 맵을 조금 더 빠르게 로딩할 수 있게 snapshot을 디스크에 저장해두고 로딩 속도를 높일 수 있습니다.</li>
</ul>
</li>
<li>덜 쓰여진 레코드
<ul>
<li>로그에 레코드를 추가하는 도중에 데이터베이스는 장애가 발생할 수 있습니다. 이러한 문제는 파일의 체크섬을 포함하여 로그의 손상된 부분을 탐지하고 이를 무시할 수 있습니다.</li>
</ul>
</li>
<li>동시성 제어
<ul>
<li>쓰기를 엄격하게 순차적으로 로그에 추가하는 일반적인 방법은 하나의 쓰기 쓰레드만 사용하는 것입니다. 세그먼트는 append-only이거나 immutable이므로, 멀티 스레드에서 동시 읽기가 가능합니다.</li>
</ul>
</li>
</ul>
<p>지금까지 살펴본 append-only 로그는 언뜻 보면 낭비처럼 보입니다. 이전 값을 새로운 값으로 덮어써서 파일을 갱신하는 방법이 더 효율적인 것같이 보입니다. 그러나 append-only는 여러 이유에서 좋은 설계라고 볼 수 있습니다. 그 예는 다음과 같습니다.</p>
<ul>
<li>추가와 세그먼트 병합은 순차적인 쓰기 작업이기 때문에 random write보다 훨씬 빠릅니다.</li>
<li>세그먼트 파일이 append-only나 immutable하면 동시성 처리와 고장 복구가 훨씬 간단해집니다. 예를 들어 값을 덮어쓰는 동안 데이터베이스가 죽는 경우에 대해 걱정할 필요가 없습니다. 왜냐하면 장애 복구시 이전 값과 새로운 값을 따로 쓰기 때문에 새로운 값을 쓰다가 데이터베이스가 죽더라도 이전 값을 이용하여 복구할 수 있습니다.</li>
<li>세그먼트 병합은 파편화되는 데이터 파일의 문제를 피할 수 있습니다.</li>
</ul>
<p>그러나 이전에 사용한 색인 방법인 해시 테이블 색인의 경우 제한사항이 있습니다. 그 제한사항은 다음과 같습니다.</p>
<ul>
<li>해시 테이블은 메모리에 저장해야 하므로 키가 너무 많은 경우 문제가 발생합니다.</li>
<li>해시 테이블의 경우 range query에 효율적이지 않습니다.</li>
</ul>
<p>지금까지 가장 간단한 쉘 기반의 가장 간단한 저장소를 시작으로 로그 기반의 데이터 저장과 이를 효율적으로 읽을 수 있는 해시 색인에 관해 살펴 보았습니다. 다음 포스트는 이어서 해시 테이블 색인의 제한사항을 갖지 않는 색인 구조를 살펴볼 예정입니다.</p>

        </p>

        <br />
        <br />

        <div class="paging post-paging" style="margin-bottom: 15px;">
            
            
            <div style="text-align: left">
                <a class="left" href="https://eoriented.github.io/post/data-models-and-query-languages-2/" rel="prev" style="color: #64BEA3">
                    <i class="fa fa-play fa-rotate-180" aria-hidden="true"></i>&nbsp;&nbsp;<span>데이터 모델(Data Models)과 질의 언어(Query Languages) - 2</span>
                </a>
            </div>
            
            
            
        </div>
    </div>

    
    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "smart-tiger" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    

    <div class="page-footer">
        
        <hr class="footer-divider">
        
            <a class="tag" href="https://eoriented.github.io/tags/keyvaluestore">#keyvaluestore</a>
        
            <a class="tag" href="https://eoriented.github.io/tags/%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4">#데이터베이스</a>
        
            <a class="tag" href="https://eoriented.github.io/tags/%EC%83%89%EC%9D%B8">#색인</a>
        
            <a class="tag" href="https://eoriented.github.io/tags/%EC%A0%80%EC%9E%A5%EC%86%8C">#저장소</a>
        
            <a class="tag" href="https://eoriented.github.io/tags/%ED%95%B4%EC%8B%9C%EC%83%89%EC%9D%B8">#해시색인</a>
        
            <a class="tag" href="https://eoriented.github.io/tags/%ED%82%A4%EA%B0%92%EC%8A%A4%ED%86%A0%EC%96%B4">#키값스토어</a>
        
            <a class="tag" href="https://eoriented.github.io/tags/%EB%8D%B0%EC%9D%B4%ED%84%B0%EA%B2%80%EC%83%89">#데이터검색</a>
        
      
    </div>


        
        </div>
        <footer class="footer-mobile">
	<div class="social-icons" style="text-align: center">
    
    <a class="social-icon" href="https://github.com/eoriented" target="_blank" rel="noopener" title="GitHub">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M13.9988029,1.32087331 C6.82105037,1.32087331 1,7.14112562 1,14.3212723 C1,20.0649109 4.72454649,24.9370678 9.89038951,26.6560892 C10.5408085,26.7757983 10.7778323,26.374374 10.7778323,26.0296121 C10.7778323,25.7215609 10.7666595,24.9035493 10.760275,23.8189856 C7.14426471,24.6042767 6.38131925,22.0760223 6.38131925,22.0760223 C5.78995672,20.5740732 4.93762853,20.1742451 4.93762853,20.1742451 C3.75729765,19.3682044 5.02701126,19.3841656 5.02701126,19.3841656 C6.33183953,19.4759425 7.01817121,20.7241085 7.01817121,20.7241085 C8.17775254,22.7104801 10.0611744,22.1366749 10.8017741,21.8038838 C10.919887,20.9643246 11.2558703,20.3913175 11.6269683,20.066507 C8.74038491,19.7385043 5.70536235,18.6228163 5.70536235,13.6413251 C5.70536235,12.2223743 6.21213051,11.0611968 7.04370914,10.1530044 C6.90963504,9.82420367 6.46351945,8.50181809 7.17139875,6.71256734 C7.17139875,6.71256734 8.26234691,6.36301702 10.7459099,8.04532771 C11.78259,7.75642995 12.8950858,7.61277914 14.000399,7.60719272 C15.1049142,7.61277914 16.2166119,7.75642995 17.2548881,8.04532771 C19.736855,6.36301702 20.8262071,6.71256734 20.8262071,6.71256734 C21.5356825,8.50181809 21.0895669,9.82420367 20.9562909,10.1530044 C21.7894656,11.0611968 22.2922435,12.2223743 22.2922435,13.6413251 C22.2922435,18.6355852 19.2524325,19.734514 16.3570705,20.0561322 C16.8231376,20.4575564 17.2389269,21.2508282 17.2389269,22.4638795 C17.2389269,24.2012564 17.2229657,25.603448 17.2229657,26.0296121 C17.2229657,26.3775663 17.4575954,26.7821827 18.116793,26.6552912 C23.2786458,24.9322794 27,20.0633148 27,14.3212723 C27,7.14112562 21.1789496,1.32087331 13.9988029,1.32087331"></path>
        </svg>
    </a>
    

    

    
    <a class="social-icon" href="mailto:eoriented@gmail.com" target="_blank" rel="noopener" title="Email">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M25.2794292,5.59128519 L14,16.8707144 L2.72057081,5.59128519 C3.06733103,5.30237414 3.51336915,5.12857603 4,5.12857603 L24,5.12857603 C24.4866308,5.12857603 24.932669,5.30237414 25.2794292,5.59128519 Z M25.9956978,6.99633695 C25.998551,7.04004843 26,7.08414302 26,7.12857603 L26,20.871424 C26,21.0798433 25.9681197,21.2808166 25.9089697,21.4697335 L18.7156355,14.2763993 L25.9956978,6.99633695 Z M24.9498374,22.6319215 C24.6672737,22.7846939 24.3437653,22.871424 24,22.871424 L4,22.871424 C3.5268522,22.871424 3.09207889,22.7071233 2.74962118,22.432463 L10.0950247,15.0870594 L13.9848068,18.9768415 L14.1878486,18.7737996 L14.2030419,18.7889929 L17.6549753,15.3370594 L24.9498374,22.6319215 Z M2.00810114,21.0526627 C2.00273908,20.9929669 2,20.9325153 2,20.871424 L2,7.12857603 C2,7.08414302 2.00144896,7.04004843 2.00430222,6.99633695 L9.03436454,14.0263993 L2.00810114,21.0526627 Z"></path>
        </svg>
    </a>
    

    
    <a class="social-icon" href="https://eoriented.github.io/index.xml" target="_blank" rel="noopener" type="application/rss+xml" title="Rss">
        <svg width="28px" height="28px" viewBox="0 0 8 8" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <circle xmlns="http://www.w3.org/2000/svg" class="symbol" cx="2" cy="6" r="1"/>
            <path xmlns="http://www.w3.org/2000/svg" class="symbol" d="m 1,4 a 3,3 0 0 1 3,3 h 1 a 4,4 0 0 0 -4,-4 z"/>
            <path xmlns="http://www.w3.org/2000/svg" class="symbol" d="m 1,2 a 5,5 0 0 1 5,5 h 1 a 6,6 0 0 0 -6,-6 z"/>
        </svg>
    </a>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    
    

    
</div>




	
		
		
		
	

	<script src="https://eoriented.github.io/js/main.min.fa5c2b23e07b5d9bfad267a52b4b24fdb053e6fb7524993383594926a3ac270c.js" integrity="sha256-+lwrI+B7XZv60melK0sk/bBT5vt1JJkzg1lJJqOsJww="></script>
</footer>
    </body>
</html>