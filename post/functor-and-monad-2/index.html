<!DOCTYPE html>

<html lang="ko-KR">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="format-detection" content="telephone=no"/>

    <title>Smart Tiger&#39;s blog</title>
    
    <link rel="apple-touch-icon" sizes="180x180" href="https://eoriented.github.io/apple-touch-icon.png">
    
    
    <link rel="icon" type="image/png" sizes="16x16" href="https://eoriented.github.io/favicon.ico">
    <link rel="manifest" href="https://eoriented.github.io/manifest.json">
    <link rel="mask-icon" href="https://eoriented.github.io/safari-pinned-tab.svg" color="#FF3DB4">
    <meta name="theme-color" content="#ffffff">

    
    
    
    <link rel="stylesheet" href="https://eoriented.github.io/css/main.min.94139811df55095d1a6820b4d1744cb3485107ea6355ed62e56340b05b421e86.css"/>

    
    
    

    
    
 
    
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-160052384-1', 'auto');
	
	ga('send', 'pageview');
}
</script>


    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
  });
  MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script> 
</head>
    <body>
        
<nav>
  <header>
    <div class="site-title">
        
        <a href="https://eoriented.github.io/">
        <img style="display: block; margin: 0px auto" width="90%" src="https://eoriented.github.io/images/logo2.png" /></a>
    </div>  
</header>
  <div class="nav-menu">
  
    <a class="color-link nav-link" href="https://eoriented.github.io/categories/bigdata/">Big data</a>
  
    <a class="color-link nav-link" href="https://eoriented.github.io/categories/machine-learning/">Machine learning</a>
  
    <a class="color-link nav-link" href="https://eoriented.github.io/categories/programming/">Programming</a>
  
    <a class="color-link nav-link" href="https://eoriented.github.io/categories/cloud/">Cloud</a>
  
    <a class="color-link nav-link" href="https://eoriented.github.io/categories/tools/">Tools</a>
  
    <a class="color-link nav-link" href="https://eoriented.github.io/categories/">Categories</a>
  
    <a class="color-link nav-link" href="https://eoriented.github.io/tags/">Tags</a>
  
  
</div>
<footer class="footer">
	<div class="social-icons" style="text-align: center">
    
    <a class="social-icon" href="https://github.com/eoriented" target="_blank" rel="noopener" title="GitHub">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M13.9988029,1.32087331 C6.82105037,1.32087331 1,7.14112562 1,14.3212723 C1,20.0649109 4.72454649,24.9370678 9.89038951,26.6560892 C10.5408085,26.7757983 10.7778323,26.374374 10.7778323,26.0296121 C10.7778323,25.7215609 10.7666595,24.9035493 10.760275,23.8189856 C7.14426471,24.6042767 6.38131925,22.0760223 6.38131925,22.0760223 C5.78995672,20.5740732 4.93762853,20.1742451 4.93762853,20.1742451 C3.75729765,19.3682044 5.02701126,19.3841656 5.02701126,19.3841656 C6.33183953,19.4759425 7.01817121,20.7241085 7.01817121,20.7241085 C8.17775254,22.7104801 10.0611744,22.1366749 10.8017741,21.8038838 C10.919887,20.9643246 11.2558703,20.3913175 11.6269683,20.066507 C8.74038491,19.7385043 5.70536235,18.6228163 5.70536235,13.6413251 C5.70536235,12.2223743 6.21213051,11.0611968 7.04370914,10.1530044 C6.90963504,9.82420367 6.46351945,8.50181809 7.17139875,6.71256734 C7.17139875,6.71256734 8.26234691,6.36301702 10.7459099,8.04532771 C11.78259,7.75642995 12.8950858,7.61277914 14.000399,7.60719272 C15.1049142,7.61277914 16.2166119,7.75642995 17.2548881,8.04532771 C19.736855,6.36301702 20.8262071,6.71256734 20.8262071,6.71256734 C21.5356825,8.50181809 21.0895669,9.82420367 20.9562909,10.1530044 C21.7894656,11.0611968 22.2922435,12.2223743 22.2922435,13.6413251 C22.2922435,18.6355852 19.2524325,19.734514 16.3570705,20.0561322 C16.8231376,20.4575564 17.2389269,21.2508282 17.2389269,22.4638795 C17.2389269,24.2012564 17.2229657,25.603448 17.2229657,26.0296121 C17.2229657,26.3775663 17.4575954,26.7821827 18.116793,26.6552912 C23.2786458,24.9322794 27,20.0633148 27,14.3212723 C27,7.14112562 21.1789496,1.32087331 13.9988029,1.32087331"></path>
        </svg>
    </a>
    

    

    
    <a class="social-icon" href="mailto:eoriented@gmail.com" target="_blank" rel="noopener" title="Email">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M25.2794292,5.59128519 L14,16.8707144 L2.72057081,5.59128519 C3.06733103,5.30237414 3.51336915,5.12857603 4,5.12857603 L24,5.12857603 C24.4866308,5.12857603 24.932669,5.30237414 25.2794292,5.59128519 Z M25.9956978,6.99633695 C25.998551,7.04004843 26,7.08414302 26,7.12857603 L26,20.871424 C26,21.0798433 25.9681197,21.2808166 25.9089697,21.4697335 L18.7156355,14.2763993 L25.9956978,6.99633695 Z M24.9498374,22.6319215 C24.6672737,22.7846939 24.3437653,22.871424 24,22.871424 L4,22.871424 C3.5268522,22.871424 3.09207889,22.7071233 2.74962118,22.432463 L10.0950247,15.0870594 L13.9848068,18.9768415 L14.1878486,18.7737996 L14.2030419,18.7889929 L17.6549753,15.3370594 L24.9498374,22.6319215 Z M2.00810114,21.0526627 C2.00273908,20.9929669 2,20.9325153 2,20.871424 L2,7.12857603 C2,7.08414302 2.00144896,7.04004843 2.00430222,6.99633695 L9.03436454,14.0263993 L2.00810114,21.0526627 Z"></path>
        </svg>
    </a>
    

    
    <a class="social-icon" href="https://eoriented.github.io/index.xml" target="_blank" rel="noopener" type="application/rss+xml" title="Rss">
        <svg width="28px" height="28px" viewBox="0 0 8 8" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <circle xmlns="http://www.w3.org/2000/svg" class="symbol" cx="2" cy="6" r="1"/>
            <path xmlns="http://www.w3.org/2000/svg" class="symbol" d="m 1,4 a 3,3 0 0 1 3,3 h 1 a 4,4 0 0 0 -4,-4 z"/>
            <path xmlns="http://www.w3.org/2000/svg" class="symbol" d="m 1,2 a 5,5 0 0 1 5,5 h 1 a 6,6 0 0 0 -6,-6 z"/>
        </svg>
    </a>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    
    

    
</div>




	
	

	<script src="https://eoriented.github.io/js/main.min.fa5c2b23e07b5d9bfad267a52b4b24fdb053e6fb7524993383594926a3ac270c.js" integrity="sha256-+lwrI+B7XZv60melK0sk/bBT5vt1JJkzg1lJJqOsJww="></script>
</footer>
</nav>
        <div id="content" class="content-container">
        
<h1 class="post-title">Functor(펑터)와 Monad(모나드) - 2</h1>
    
    <div>
        <p>
        <p>이전 포스트에서는 펑터가 무엇인지에 관해 살펴보았습니다. 펑터는 유용한 추상화이지만 약간의 문제가 존재합니다. 펑터의 <code>map</code> 함수가 일반적인 값을 반환하는 경우에는 문제가 되지 않지만 만약 펑터를 반환하면 어떻게 될까요? 물론 펑터 역시 값이기 때문에 상관은 없겠지만 펑터를 반환하는 경우 결과가 조금 다르게 나올 수 있습니다. 다음 예제를 통해서 살펴보겠습니다.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#007020;font-weight:bold">val</span> functorForOption<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">Functor</span><span style="color:#666">[</span><span style="color:#902000">Option</span><span style="color:#666">]</span> <span style="color:#007020;font-weight:bold">=</span> <span style="color:#007020;font-weight:bold">new</span> <span style="color:#0e84b5;font-weight:bold">Functor</span><span style="color:#666">[</span><span style="color:#902000">Option</span><span style="color:#666">]</span> <span style="color:#666">{</span>
  <span style="color:#007020;font-weight:bold">def</span> map<span style="color:#666">[</span><span style="color:#902000">A</span>, <span style="color:#902000">B</span><span style="color:#666">](</span>fa<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">Option</span><span style="color:#666">[</span><span style="color:#902000">A</span><span style="color:#666">])(</span>f<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">A</span> <span style="color:#666">=&gt;</span> B<span style="color:#666">)</span><span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">Option</span><span style="color:#666">[</span><span style="color:#902000">B</span><span style="color:#666">]</span> <span style="color:#007020;font-weight:bold">=</span> fa <span style="color:#007020;font-weight:bold">match</span> <span style="color:#666">{</span>
    <span style="color:#007020;font-weight:bold">case</span> <span style="color:#0e84b5;font-weight:bold">None</span>    <span style="color:#007020;font-weight:bold">=&gt;</span> <span style="color:#0e84b5;font-weight:bold">None</span>
    <span style="color:#007020;font-weight:bold">case</span> <span style="color:#0e84b5;font-weight:bold">Some</span><span style="color:#666">(</span>a<span style="color:#666">)</span> <span style="color:#007020;font-weight:bold">=&gt;</span> <span style="color:#0e84b5;font-weight:bold">Some</span><span style="color:#666">(</span>f<span style="color:#666">(</span>a<span style="color:#666">))</span>
  <span style="color:#666">}</span>
<span style="color:#666">}</span>

<span style="color:#007020;font-weight:bold">def</span> stringToInt<span style="color:#666">(</span>s<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">String</span><span style="color:#666">)</span><span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">Option</span><span style="color:#666">[</span><span style="color:#902000">Int</span><span style="color:#666">]</span> <span style="color:#007020;font-weight:bold">=</span> <span style="color:#666">{</span>
  <span style="color:#007020;font-weight:bold">try</span> <span style="color:#666">{</span>
    <span style="color:#0e84b5;font-weight:bold">Some</span><span style="color:#666">(</span>s<span style="color:#666">.</span>toInt<span style="color:#666">)</span>
  <span style="color:#666">}</span> <span style="color:#007020;font-weight:bold">catch</span> <span style="color:#666">{</span>
    <span style="color:#007020;font-weight:bold">case</span> e<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">NumberFormatException</span> <span style="color:#666">=&gt;</span>
      <span style="color:#0e84b5;font-weight:bold">None</span>
  <span style="color:#666">}</span>
<span style="color:#666">}</span>

<span style="color:#007020;font-weight:bold">val</span> opt<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">Option</span><span style="color:#666">[</span><span style="color:#902000">Option</span><span style="color:#666">[</span><span style="color:#902000">Int</span><span style="color:#666">]]</span> <span style="color:#007020;font-weight:bold">=</span> <span style="color:#666">{</span>
  functorForOption<span style="color:#666">.</span>map<span style="color:#666">(</span><span style="color:#0e84b5;font-weight:bold">Some</span><span style="color:#666">(</span><span style="color:#4070a0">&#34;hello&#34;</span><span style="color:#666">))(</span>x <span style="color:#007020;font-weight:bold">=&gt;</span> stringToInt<span style="color:#666">(</span>x<span style="color:#666">))</span>
<span style="color:#666">}</span>
</code></pre></div><p>일단 위의 예제 코드에는 문법적으로 이상은 없습니다. <code>stringToInt</code> 함수가 <code>Int</code>를 반환한다면 <code>Option[Int]</code>가 될 것입니다. 그러나 펑터의 <code>map</code> 함수가 <code>Option</code>을 리턴하기 때문에 위 예제의 <code>opt</code>의 타입은 <code>Option[Option[Int]]</code>이 됩니다. 위의 예제처럼 펑터가 펑터를 감싼 형태가 되지 때문에 합성과 체이닝을 힘들게 합니다. 한번 다음의 예제를 통해 살펴보겠습니다.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#007020;font-weight:bold">val</span> intOpt <span style="color:#007020;font-weight:bold">=</span> <span style="color:#0e84b5;font-weight:bold">Option</span><span style="color:#666">(</span><span style="color:#40a070">10</span><span style="color:#666">)</span>
<span style="color:#007020;font-weight:bold">val</span> intOptOpt <span style="color:#007020;font-weight:bold">=</span> <span style="color:#0e84b5;font-weight:bold">Option</span><span style="color:#666">(</span><span style="color:#0e84b5;font-weight:bold">Option</span><span style="color:#666">(</span><span style="color:#40a070">10</span><span style="color:#666">))</span>

<span style="color:#007020;font-weight:bold">val</span> doubleOpt1 <span style="color:#007020;font-weight:bold">=</span> intOpt<span style="color:#666">.</span>map<span style="color:#666">(</span><span style="color:#007020;font-weight:bold">_</span><span style="color:#666">.</span>toDouble<span style="color:#666">)</span>
<span style="color:#007020;font-weight:bold">val</span> doubleOpt2 <span style="color:#007020;font-weight:bold">=</span> intOptOpt<span style="color:#666">.</span>map<span style="color:#666">(</span><span style="color:#007020;font-weight:bold">_</span><span style="color:#666">.</span>toDouble<span style="color:#666">)</span> <span style="color:#60a0b0;font-style:italic">// compile error
</span></code></pre></div><p>위의 예제는 <code>Option</code>안에 있는 <code>Int</code>값을 <code>Double</code>로 바꾸는 방법을 보여줍니다. <code>Int =&gt; Double</code>로 구성된 함수만 있다면 <code>Option[Int]</code>의 값을 <code>Option[Double]</code>로 쉽게 바꿀 수 있습니다. 하지만 <code>Option</code>이 두 번 감싸져 있는 <code>intOptOpt</code>의 예제는 우리가 생각한대로 동작을 하지 않습니다. 펑터가 두 번 감싸져 있는 경우 펑터가 제 기능을 수행하기 어려워집니다. 하지만 리턴 값이 펑터인 경우는 일반적이기 때문에 이를 해결해야 합니다. 그래서 특별한 함수를 도입해서 중첩된 펑터를 납작(flat)하게 만드는 기능을 제공합니다.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#007020;font-weight:bold">val</span> intOpt2<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">Option</span><span style="color:#666">[</span><span style="color:#902000">Int</span><span style="color:#666">]</span> <span style="color:#007020;font-weight:bold">=</span> intOptOpt<span style="color:#666">.</span>flatten
</code></pre></div><p>이렇게 되면 위에서 발생한 문제는 해결됩니다. 그러나 이렇게 사용되는 경우가 흔하기 때문에 펑터를 리턴하는 <code>map</code>함수를 사용한 다음 매번 <code>flatten</code>을 호출하는 것은 번거롭습니다. 그렇기 때문에 <code>flatMap</code>이라는 특별한 함수를 도입합니다. <code>flatMap</code>과 <code>map</code>은 유사하지만 파라미터로 받는 함수가 펑터(정확히는 모나드입니다)를 반환합니다. 그러면 스칼라에서 모나드는 다음과 같이 선언합니다.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#007020;font-weight:bold">trait</span> <span style="color:#0e84b5;font-weight:bold">Monad</span><span style="color:#666">[</span><span style="color:#902000">F</span><span style="color:#666">[</span><span style="color:#007020;font-weight:bold">_</span><span style="color:#666">]]</span> <span style="color:#0e84b5;font-weight:bold">extends</span> <span style="color:#0e84b5;font-weight:bold">Functor</span><span style="color:#666">[</span><span style="color:#902000">F</span><span style="color:#666">]</span> <span style="color:#666">{</span>
  <span style="color:#007020;font-weight:bold">def</span> unit<span style="color:#666">[</span><span style="color:#902000">A</span><span style="color:#666">](</span>a<span style="color:#007020;font-weight:bold">:</span> <span style="color:#666">=&gt;</span> A<span style="color:#666">)</span><span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">F</span><span style="color:#666">[</span><span style="color:#902000">A</span><span style="color:#666">]</span>
  <span style="color:#007020;font-weight:bold">def</span> flatMap<span style="color:#666">[</span><span style="color:#902000">A</span>,<span style="color:#902000">B</span><span style="color:#666">](</span>ma<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">F</span><span style="color:#666">[</span><span style="color:#902000">A</span><span style="color:#666">])(</span>f<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">A</span> <span style="color:#666">=&gt;</span> F<span style="color:#666">[</span><span style="color:#902000">B</span><span style="color:#666">])</span><span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">F</span><span style="color:#666">[</span><span style="color:#902000">B</span><span style="color:#666">]</span>
<span style="color:#666">}</span>
</code></pre></div><p><code>flatMap</code>을 사용하면 첫 번째 예제인 <code>stringToInt</code>을 사용하는 코드가 중첩되는 모나드의 형태가 아닌 하나의 모나드로 감싸져 있는 형태가 됩니다. 그러면 함수를 합성하거나 체이닝해서 사용하는 것이 한결 수월해 집니다. <code>flatMap</code>만 있다고 해서 어떤 클래스를 모나드라고 할 수 없습니다. 모나드는 특정 법칙을 만족해야 합니다. 이 모나드 법칙은 다음과 같습니다.</p>
<h2 id="모나드-법칙">모나드 법칙</h2>
<h3 id="1-항등법칙">1) 항등법칙</h3>
<p>모나드는 항등법칙을 만족합니다. 모나드는 모나드에 대한 항등원을 가지고 있어야 하는데 그것을 정의한 것이 바로 <code>unit</code>이라는 함수입니다. <code>unit</code> 함수의 정의는 다음과 같습니다.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#007020;font-weight:bold">def</span> unit<span style="color:#666">[</span><span style="color:#902000">A</span><span style="color:#666">](</span>a<span style="color:#007020;font-weight:bold">:</span> <span style="color:#666">=&gt;</span> A<span style="color:#666">)</span><span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">F</span><span style="color:#666">[</span><span style="color:#902000">A</span><span style="color:#666">]</span>
</code></pre></div><p>임의의 모나드와 <code>unit</code>의 합성은 원래 그 모나드와 같습니다. 이것은 2가지 법칙으로 표현되는데 <code>왼쪽 항등법칙</code>과 <code>오른쪽 항등법칙</code>입니다. 간단히 이 법칙들을 <code>flatMap</code>으로 표현하면 다음과 같습니다.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#007020;font-weight:bold">def</span> unit<span style="color:#666">[</span><span style="color:#902000">A</span><span style="color:#666">](</span>a<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">A</span><span style="color:#666">)</span><span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">Option</span><span style="color:#666">[</span><span style="color:#902000">A</span><span style="color:#666">]</span> <span style="color:#007020;font-weight:bold">=</span> <span style="color:#0e84b5;font-weight:bold">Some</span><span style="color:#666">(</span>a<span style="color:#666">)</span>
<span style="color:#007020;font-weight:bold">def</span> flatMap<span style="color:#666">[</span><span style="color:#902000">A</span>,<span style="color:#902000">B</span><span style="color:#666">](</span>ma<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">Option</span><span style="color:#666">[</span><span style="color:#902000">A</span><span style="color:#666">])(</span>f<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">A</span> <span style="color:#666">=&gt;</span> <span style="color:#0e84b5;font-weight:bold">Option</span><span style="color:#666">[</span><span style="color:#902000">B</span><span style="color:#666">])</span><span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">Option</span><span style="color:#666">[</span><span style="color:#902000">B</span><span style="color:#666">]</span> <span style="color:#007020;font-weight:bold">=</span> ma flatMap f

<span style="color:#007020;font-weight:bold">def</span> f<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">Int</span> <span style="color:#666">=&gt;</span> <span style="color:#0e84b5;font-weight:bold">Option</span><span style="color:#666">[</span><span style="color:#902000">Int</span><span style="color:#666">]</span> <span style="color:#007020;font-weight:bold">=</span> a <span style="color:#007020;font-weight:bold">=&gt;</span> <span style="color:#0e84b5;font-weight:bold">Some</span><span style="color:#666">(</span>a <span style="color:#666">*</span> <span style="color:#40a070">2</span><span style="color:#666">)</span>
<span style="color:#007020;font-weight:bold">val</span> x <span style="color:#007020;font-weight:bold">=</span> <span style="color:#40a070">2</span>

flatMap<span style="color:#666">(</span>unit<span style="color:#666">(</span>x<span style="color:#666">))(</span>f<span style="color:#666">)</span> <span style="color:#666">==</span> f<span style="color:#666">(</span>x<span style="color:#666">)</span> <span style="color:#60a0b0;font-style:italic">// true
</span><span style="color:#60a0b0;font-style:italic"></span>flatMap<span style="color:#666">(</span>f<span style="color:#666">(</span>x<span style="color:#666">))(</span>unit<span style="color:#666">)</span> <span style="color:#666">==</span> f<span style="color:#666">(</span>x<span style="color:#666">)</span> <span style="color:#60a0b0;font-style:italic">// true
</span></code></pre></div><h3 id="2-결합법칙">2) 결합법칙</h3>
<p>모나드는 결합법칙을 만족해야 합니다. 마찬가지로 예제를 통해 살펴보겠습니다.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#007020;font-weight:bold">def</span> unit<span style="color:#666">[</span><span style="color:#902000">A</span><span style="color:#666">](</span>a<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">A</span><span style="color:#666">)</span><span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">Option</span><span style="color:#666">[</span><span style="color:#902000">A</span><span style="color:#666">]</span> <span style="color:#007020;font-weight:bold">=</span> <span style="color:#0e84b5;font-weight:bold">Some</span><span style="color:#666">(</span>a<span style="color:#666">)</span>
<span style="color:#007020;font-weight:bold">def</span> flatMap<span style="color:#666">[</span><span style="color:#902000">A</span>,<span style="color:#902000">B</span><span style="color:#666">](</span>ma<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">Option</span><span style="color:#666">[</span><span style="color:#902000">A</span><span style="color:#666">])(</span>f<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">A</span> <span style="color:#666">=&gt;</span> <span style="color:#0e84b5;font-weight:bold">Option</span><span style="color:#666">[</span><span style="color:#902000">B</span><span style="color:#666">])</span><span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">Option</span><span style="color:#666">[</span><span style="color:#902000">B</span><span style="color:#666">]</span> <span style="color:#007020;font-weight:bold">=</span> ma flatMap f

<span style="color:#007020;font-weight:bold">val</span> f<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">Int</span> <span style="color:#666">=&gt;</span> <span style="color:#0e84b5;font-weight:bold">Option</span><span style="color:#666">[</span><span style="color:#902000">Int</span><span style="color:#666">]</span> <span style="color:#007020;font-weight:bold">=</span> a <span style="color:#007020;font-weight:bold">=&gt;</span> <span style="color:#0e84b5;font-weight:bold">Some</span><span style="color:#666">(</span>a <span style="color:#666">+</span> <span style="color:#40a070">2</span><span style="color:#666">)</span>
<span style="color:#007020;font-weight:bold">val</span> g<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">Int</span> <span style="color:#666">=&gt;</span> <span style="color:#0e84b5;font-weight:bold">Option</span><span style="color:#666">[</span><span style="color:#902000">Int</span><span style="color:#666">]</span> <span style="color:#007020;font-weight:bold">=</span> a <span style="color:#007020;font-weight:bold">=&gt;</span> <span style="color:#0e84b5;font-weight:bold">Some</span><span style="color:#666">(</span>a <span style="color:#666">*</span> <span style="color:#40a070">2</span><span style="color:#666">)</span>

<span style="color:#007020;font-weight:bold">val</span> ma <span style="color:#007020;font-weight:bold">=</span> <span style="color:#0e84b5;font-weight:bold">Some</span><span style="color:#666">(</span><span style="color:#40a070">1</span><span style="color:#666">)</span>
<span style="color:#007020;font-weight:bold">val</span> f<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">Int</span> <span style="color:#666">=&gt;</span> <span style="color:#0e84b5;font-weight:bold">Option</span><span style="color:#666">[</span><span style="color:#902000">Int</span><span style="color:#666">]</span> <span style="color:#007020;font-weight:bold">=</span> a <span style="color:#007020;font-weight:bold">=&gt;</span> <span style="color:#0e84b5;font-weight:bold">Some</span><span style="color:#666">(</span><span style="color:#40a070">1</span><span style="color:#666">)</span>

<span style="color:#666">(</span>ma flatMap f flatMap g<span style="color:#666">)</span> <span style="color:#666">==</span> <span style="color:#666">(</span>ma flatMap<span style="color:#666">(</span>a <span style="color:#007020;font-weight:bold">=&gt;</span> f<span style="color:#666">(</span>a<span style="color:#666">)</span> flatMap g<span style="color:#666">))</span> <span style="color:#60a0b0;font-style:italic">// true
</span></code></pre></div><p>위의 예제와 같이 모나드는 결합법칙을 만족합니다. 모나드는 어떤 일이 일어나도 그것이 결합법칙과 항등법칙을 만족한다는 것을 의미합니다.<br>
모나드의 <code>map</code>은 따로 구현할 필요가 없습니다. <code>flatMap</code>으로 쉽게 구현할 수 있습니다.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#007020;font-weight:bold">def</span> map<span style="color:#666">[</span><span style="color:#902000">A</span>,<span style="color:#902000">B</span><span style="color:#666">](</span>ma<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">F</span><span style="color:#666">[</span><span style="color:#902000">A</span><span style="color:#666">])(</span>f<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">A</span> <span style="color:#666">=&gt;</span> B<span style="color:#666">)</span><span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">F</span><span style="color:#666">[</span><span style="color:#902000">B</span><span style="color:#666">]</span> <span style="color:#007020;font-weight:bold">=</span>
  flatMap<span style="color:#666">(</span>ma<span style="color:#666">)(</span>a <span style="color:#007020;font-weight:bold">=&gt;</span> unit<span style="color:#666">(</span>f<span style="color:#666">(</span>a<span style="color:#666">)))</span>
</code></pre></div><p>그럼 이러한 모나드는 왜 쓰는 것일까요? 간단한 예제를 통해서 모나드의 강력함을 살펴보도록 하겠습니다.<br>
스칼라에서는 <code>Future</code> 모나드라는 것이 있습니다. 이 <code>Future</code>는 미래의 어떤 값을 가진다는 의미입니다. 다음과 같이 정의된 함수들이 있습니다.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#007020;font-weight:bold">def</span> loadCustomer<span style="color:#666">(</span>id<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">Int</span><span style="color:#666">)</span><span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">Future</span><span style="color:#666">[</span><span style="color:#902000">Customer</span><span style="color:#666">]</span>

<span style="color:#007020;font-weight:bold">def</span> readBasket<span style="color:#666">(</span>customer<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">Customer</span><span style="color:#666">)</span><span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">Future</span><span style="color:#666">[</span><span style="color:#902000">Basket</span><span style="color:#666">]</span>

<span style="color:#007020;font-weight:bold">def</span> calculateDiscount<span style="color:#666">(</span>basket<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">Basket</span><span style="color:#666">,</span> dayOfWeek<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">DayOfWeek</span><span style="color:#666">)</span><span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">Future</span><span style="color:#666">[</span><span style="color:#902000">Double</span><span style="color:#666">]</span> 
</code></pre></div><p>위에서 정의된 함수 시그니처만 살펴보면 어떤 작업을 수행하는지 알 수 있습니다. 각각의 함수들은 <code>Future[A]</code>를 리턴합니다. 그리고 그 함수는 완료하는데 일정 시간이 걸립니다. 위의 함수들을 모나드 연산자를 사용하면 마치 블로킹 호출처럼 함수들을 합성할 수 있습니다.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#007020;font-weight:bold">val</span> discount <span style="color:#007020;font-weight:bold">=</span> loadCustomer<span style="color:#666">(</span><span style="color:#40a070">513</span><span style="color:#666">)</span>
  <span style="color:#666">.</span>flatMap<span style="color:#666">(</span>readBasket<span style="color:#666">)</span>
  <span style="color:#666">.</span>flatMap<span style="color:#666">(</span>basket <span style="color:#007020;font-weight:bold">=&gt;</span> calculateDiscount<span style="color:#666">(</span>basket<span style="color:#666">,</span> <span style="color:#0e84b5;font-weight:bold">DayOfWeek</span><span style="color:#666">.</span><span style="color:#0e84b5;font-weight:bold">Friday</span><span style="color:#666">))</span>
</code></pre></div><p>모나드의 <code>flatMap</code>은 모나드 타입을 유지해야 하므로 <code>flatMap</code>의 결과가 전부 <code>Future</code>입니다. 이렇게 코드를 작성을 하게 되면 코드들이 완전히 비동기적으로 동작하는 장점이 생깁니다. 즉, <code>loadCustomer</code>를 호출하면 블로킹이 되지 않고 바로 <code>Future</code>를 반환합니다. 그 다음 <code>readBasket</code> 역시 앞의 <code>Future</code> 값을 통해 새로운 <code>Future</code>를 반환하기 됩니다. 모나드를 사용하여 간단하게 비동기 파이프라인을 구성한 것입니다.</p>
<p>이번 포스트에서는 함수형 프로그래밍에서 사용되는 중요한 개념인 <strong>펑터</strong>와 <strong>모나드</strong>에 대해 알아보았습니다. 함수형 프로그래밍 언어를 사용하면서 아마 인지하진 않았지만 펑터와 모나드를 사용하셨을 것입니다. 이번 포스트를 통해 펑터와 모나드에 대한 개념이 조금 더 친숙해졌으면 좋겠습니다.</p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://book.naver.com/bookdb/book_detail.nhn?bid=8829454">스칼라로 배우는 함수형 프로그래밍</a></li>
<li><a href="https://medium.com/@jooyunghan/functor-and-monad-examples-in-plain-java-9ea4d6630c6">(번역) Functor and monad examples in plain Java</a></li>
<li><a href="https://github.com/enshahar/BasicFPinScala/blob/master/Intermediate/Monad.md">스칼라 초중급자를 위한 모나드 해설</a></li>
<li><a href="https://tech.kakao.com/2016/03/03/monad-programming-with-scala-future/">Monad Programming with Scala Future</a></li>
<li><a href="http://adit.io/posts/2013-04-17-functors,_applicatives,_and_monads_in_pictures.html">Functors, Applicatives, And Monads In Pictures</a></li>
<li><a href="https://typelevel.org/cats/typeclasses/functor.html">Functor of cats</a></li>
<li><a href="https://sslee05.github.io/blog/2017/09/11/scala-monad/">scala Monad</a></li>
</ul>

        </p>

        <br />
        <br />

        <div class="paging post-paging" style="margin-bottom: 15px;">
            
            
            <div style="text-align: left">
                <a class="left" href="https://eoriented.github.io/post/functor-and-monad-1/" rel="prev" style="color: #64BEA3">
                    <i class="fa fa-play fa-rotate-180" aria-hidden="true"></i>&nbsp;&nbsp;<span>Functor(펑터)와 Monad(모나드) - 1</span>
                </a>
            </div>
            
            
            
        </div>
    </div>

    
    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "smart-tiger" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    

    <div class="page-footer">
        
        <hr class="footer-divider">
        
            <a class="tag" href="https://eoriented.github.io/tags/functional-programming">#functional programming</a>
        
            <a class="tag" href="https://eoriented.github.io/tags/functor">#functor</a>
        
            <a class="tag" href="https://eoriented.github.io/tags/monad">#monad</a>
        
            <a class="tag" href="https://eoriented.github.io/tags/scala">#scala</a>
        
            <a class="tag" href="https://eoriented.github.io/tags/cats">#cats</a>
        
            <a class="tag" href="https://eoriented.github.io/tags/scalaz">#scalaz</a>
        
      
    </div>


        
        </div>
        <footer class="footer-mobile">
	<div class="social-icons" style="text-align: center">
    
    <a class="social-icon" href="https://github.com/eoriented" target="_blank" rel="noopener" title="GitHub">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M13.9988029,1.32087331 C6.82105037,1.32087331 1,7.14112562 1,14.3212723 C1,20.0649109 4.72454649,24.9370678 9.89038951,26.6560892 C10.5408085,26.7757983 10.7778323,26.374374 10.7778323,26.0296121 C10.7778323,25.7215609 10.7666595,24.9035493 10.760275,23.8189856 C7.14426471,24.6042767 6.38131925,22.0760223 6.38131925,22.0760223 C5.78995672,20.5740732 4.93762853,20.1742451 4.93762853,20.1742451 C3.75729765,19.3682044 5.02701126,19.3841656 5.02701126,19.3841656 C6.33183953,19.4759425 7.01817121,20.7241085 7.01817121,20.7241085 C8.17775254,22.7104801 10.0611744,22.1366749 10.8017741,21.8038838 C10.919887,20.9643246 11.2558703,20.3913175 11.6269683,20.066507 C8.74038491,19.7385043 5.70536235,18.6228163 5.70536235,13.6413251 C5.70536235,12.2223743 6.21213051,11.0611968 7.04370914,10.1530044 C6.90963504,9.82420367 6.46351945,8.50181809 7.17139875,6.71256734 C7.17139875,6.71256734 8.26234691,6.36301702 10.7459099,8.04532771 C11.78259,7.75642995 12.8950858,7.61277914 14.000399,7.60719272 C15.1049142,7.61277914 16.2166119,7.75642995 17.2548881,8.04532771 C19.736855,6.36301702 20.8262071,6.71256734 20.8262071,6.71256734 C21.5356825,8.50181809 21.0895669,9.82420367 20.9562909,10.1530044 C21.7894656,11.0611968 22.2922435,12.2223743 22.2922435,13.6413251 C22.2922435,18.6355852 19.2524325,19.734514 16.3570705,20.0561322 C16.8231376,20.4575564 17.2389269,21.2508282 17.2389269,22.4638795 C17.2389269,24.2012564 17.2229657,25.603448 17.2229657,26.0296121 C17.2229657,26.3775663 17.4575954,26.7821827 18.116793,26.6552912 C23.2786458,24.9322794 27,20.0633148 27,14.3212723 C27,7.14112562 21.1789496,1.32087331 13.9988029,1.32087331"></path>
        </svg>
    </a>
    

    

    
    <a class="social-icon" href="mailto:eoriented@gmail.com" target="_blank" rel="noopener" title="Email">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M25.2794292,5.59128519 L14,16.8707144 L2.72057081,5.59128519 C3.06733103,5.30237414 3.51336915,5.12857603 4,5.12857603 L24,5.12857603 C24.4866308,5.12857603 24.932669,5.30237414 25.2794292,5.59128519 Z M25.9956978,6.99633695 C25.998551,7.04004843 26,7.08414302 26,7.12857603 L26,20.871424 C26,21.0798433 25.9681197,21.2808166 25.9089697,21.4697335 L18.7156355,14.2763993 L25.9956978,6.99633695 Z M24.9498374,22.6319215 C24.6672737,22.7846939 24.3437653,22.871424 24,22.871424 L4,22.871424 C3.5268522,22.871424 3.09207889,22.7071233 2.74962118,22.432463 L10.0950247,15.0870594 L13.9848068,18.9768415 L14.1878486,18.7737996 L14.2030419,18.7889929 L17.6549753,15.3370594 L24.9498374,22.6319215 Z M2.00810114,21.0526627 C2.00273908,20.9929669 2,20.9325153 2,20.871424 L2,7.12857603 C2,7.08414302 2.00144896,7.04004843 2.00430222,6.99633695 L9.03436454,14.0263993 L2.00810114,21.0526627 Z"></path>
        </svg>
    </a>
    

    
    <a class="social-icon" href="https://eoriented.github.io/index.xml" target="_blank" rel="noopener" type="application/rss+xml" title="Rss">
        <svg width="28px" height="28px" viewBox="0 0 8 8" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <circle xmlns="http://www.w3.org/2000/svg" class="symbol" cx="2" cy="6" r="1"/>
            <path xmlns="http://www.w3.org/2000/svg" class="symbol" d="m 1,4 a 3,3 0 0 1 3,3 h 1 a 4,4 0 0 0 -4,-4 z"/>
            <path xmlns="http://www.w3.org/2000/svg" class="symbol" d="m 1,2 a 5,5 0 0 1 5,5 h 1 a 6,6 0 0 0 -6,-6 z"/>
        </svg>
    </a>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    
    

    
</div>




	
		
		
		
	

	<script src="https://eoriented.github.io/js/main.min.fa5c2b23e07b5d9bfad267a52b4b24fdb053e6fb7524993383594926a3ac270c.js" integrity="sha256-+lwrI+B7XZv60melK0sk/bBT5vt1JJkzg1lJJqOsJww="></script>
</footer>
    </body>
</html>