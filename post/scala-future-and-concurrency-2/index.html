<!DOCTYPE html>

<html lang="ko-KR">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="format-detection" content="telephone=no"/>

    <title>Smart Tiger&#39;s blog</title>
    
    <link rel="apple-touch-icon" sizes="180x180" href="https://eoriented.github.io/apple-touch-icon.png">
    
    
    <link rel="icon" type="image/png" sizes="16x16" href="https://eoriented.github.io/favicon.ico">
    <link rel="manifest" href="https://eoriented.github.io/manifest.json">
    <link rel="mask-icon" href="https://eoriented.github.io/safari-pinned-tab.svg" color="#FF3DB4">
    <meta name="theme-color" content="#ffffff">

    
    
    
    <link rel="stylesheet" href="https://eoriented.github.io/css/main.min.58d8fb1d0665cc84d66363e10775e6788da13d84f3228d917962491979dcccbd.css"/>

    
    
    

    
    
 
    
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-160052384-1', 'auto');
	
	ga('send', 'pageview');
}
</script>


    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
    <body>
        
<nav>
  <header>
    <div class="site-title">
        
        <a href="https://eoriented.github.io/">
        <img style="display: block; margin: 0px auto" width="90%" src="https://eoriented.github.io/images/logo2.png" /></a>
    </div>  
</header>
  <div class="nav-menu">
  
    <a class="color-link nav-link" href="https://eoriented.github.io/categories/">Categories</a>
  
    <a class="color-link nav-link" href="https://eoriented.github.io/tags/">Tags</a>
  
    <a class="color-link nav-link" href="https://eoriented.github.io/about/">About</a>
  
  
</div>
<footer class="footer">
	<div class="social-icons" style="text-align: center">
    
    <a class="social-icon" href="https://github.com/eoriented" target="_blank" rel="noopener" title="GitHub">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M13.9988029,1.32087331 C6.82105037,1.32087331 1,7.14112562 1,14.3212723 C1,20.0649109 4.72454649,24.9370678 9.89038951,26.6560892 C10.5408085,26.7757983 10.7778323,26.374374 10.7778323,26.0296121 C10.7778323,25.7215609 10.7666595,24.9035493 10.760275,23.8189856 C7.14426471,24.6042767 6.38131925,22.0760223 6.38131925,22.0760223 C5.78995672,20.5740732 4.93762853,20.1742451 4.93762853,20.1742451 C3.75729765,19.3682044 5.02701126,19.3841656 5.02701126,19.3841656 C6.33183953,19.4759425 7.01817121,20.7241085 7.01817121,20.7241085 C8.17775254,22.7104801 10.0611744,22.1366749 10.8017741,21.8038838 C10.919887,20.9643246 11.2558703,20.3913175 11.6269683,20.066507 C8.74038491,19.7385043 5.70536235,18.6228163 5.70536235,13.6413251 C5.70536235,12.2223743 6.21213051,11.0611968 7.04370914,10.1530044 C6.90963504,9.82420367 6.46351945,8.50181809 7.17139875,6.71256734 C7.17139875,6.71256734 8.26234691,6.36301702 10.7459099,8.04532771 C11.78259,7.75642995 12.8950858,7.61277914 14.000399,7.60719272 C15.1049142,7.61277914 16.2166119,7.75642995 17.2548881,8.04532771 C19.736855,6.36301702 20.8262071,6.71256734 20.8262071,6.71256734 C21.5356825,8.50181809 21.0895669,9.82420367 20.9562909,10.1530044 C21.7894656,11.0611968 22.2922435,12.2223743 22.2922435,13.6413251 C22.2922435,18.6355852 19.2524325,19.734514 16.3570705,20.0561322 C16.8231376,20.4575564 17.2389269,21.2508282 17.2389269,22.4638795 C17.2389269,24.2012564 17.2229657,25.603448 17.2229657,26.0296121 C17.2229657,26.3775663 17.4575954,26.7821827 18.116793,26.6552912 C23.2786458,24.9322794 27,20.0633148 27,14.3212723 C27,7.14112562 21.1789496,1.32087331 13.9988029,1.32087331"></path>
        </svg>
    </a>
    

    
    <a class="social-icon" href="https://www.linkedin.com/in/kimminho" target="_blank" rel="noopener" title="LinkedIn">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M2,3.654102 C2,2.69908141 2.79442509,1.92397846 3.77383592,1.92397846 L24.2261641,1.92397846 C25.2058917,1.92397846 26,2.69908141 26,3.654102 L26,24.3462148 C26,25.3015521 25.2058917,26.0760215 24.2261641,26.0760215 L3.77383592,26.0760215 C2.79442509,26.0760215 2,25.3015521 2,24.3465315 L2,3.65378524 L2,3.654102 Z M9.27526132,22.1415901 L9.27526132,11.2356668 L5.65030092,11.2356668 L5.65030092,22.1415901 L9.27557808,22.1415901 L9.27526132,22.1415901 Z M7.46341463,9.74691162 C8.72727273,9.74691162 9.51409566,8.90940767 9.51409566,7.86284447 C9.49033893,6.79252455 8.72727273,5.97846056 7.48748812,5.97846056 C6.24675325,5.97846056 5.43649034,6.79252455 5.43649034,7.86284447 C5.43649034,8.90940767 6.22299652,9.74691162 7.4396579,9.74691162 L7.46309788,9.74691162 L7.46341463,9.74691162 Z M11.2815965,22.1415901 L14.9062401,22.1415901 L14.9062401,16.0519481 C14.9062401,15.7263225 14.9299968,15.4000634 15.0256573,15.1675641 C15.2876148,14.5159962 15.8840672,13.8416218 16.8856509,13.8416218 C18.1970225,13.8416218 18.7218879,14.8416218 18.7218879,16.3078872 L18.7218879,22.1415901 L22.3465315,22.1415901 L22.3465315,15.8885017 C22.3465315,12.5388027 20.5584416,10.9800443 18.1735825,10.9800443 C16.2182452,10.9800443 15.3595185,12.072854 14.8824834,12.8172315 L14.9065569,12.8172315 L14.9065569,11.2359835 L11.2819132,11.2359835 C11.3291099,12.2591067 11.2815965,22.1419069 11.2815965,22.1419069 L11.2815965,22.1415901 Z"></path>
        </svg>
    </a>
    

    
    <a class="social-icon" href="mailto:eoriented@gmail.com" target="_blank" rel="noopener" title="Email">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M25.2794292,5.59128519 L14,16.8707144 L2.72057081,5.59128519 C3.06733103,5.30237414 3.51336915,5.12857603 4,5.12857603 L24,5.12857603 C24.4866308,5.12857603 24.932669,5.30237414 25.2794292,5.59128519 Z M25.9956978,6.99633695 C25.998551,7.04004843 26,7.08414302 26,7.12857603 L26,20.871424 C26,21.0798433 25.9681197,21.2808166 25.9089697,21.4697335 L18.7156355,14.2763993 L25.9956978,6.99633695 Z M24.9498374,22.6319215 C24.6672737,22.7846939 24.3437653,22.871424 24,22.871424 L4,22.871424 C3.5268522,22.871424 3.09207889,22.7071233 2.74962118,22.432463 L10.0950247,15.0870594 L13.9848068,18.9768415 L14.1878486,18.7737996 L14.2030419,18.7889929 L17.6549753,15.3370594 L24.9498374,22.6319215 Z M2.00810114,21.0526627 C2.00273908,20.9929669 2,20.9325153 2,20.871424 L2,7.12857603 C2,7.08414302 2.00144896,7.04004843 2.00430222,6.99633695 L9.03436454,14.0263993 L2.00810114,21.0526627 Z"></path>
        </svg>
    </a>
    

    
    <a class="social-icon" href="https://eoriented.github.io/index.xml" target="_blank" rel="noopener" type="application/rss+xml" title="Rss">
        <svg width="28px" height="28px" viewBox="0 0 8 8" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <circle xmlns="http://www.w3.org/2000/svg" class="symbol" cx="2" cy="6" r="1"/>
            <path xmlns="http://www.w3.org/2000/svg" class="symbol" d="m 1,4 a 3,3 0 0 1 3,3 h 1 a 4,4 0 0 0 -4,-4 z"/>
            <path xmlns="http://www.w3.org/2000/svg" class="symbol" d="m 1,2 a 5,5 0 0 1 5,5 h 1 a 6,6 0 0 0 -6,-6 z"/>
        </svg>
    </a>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    
    

    
</div>




	
	

	<script src="https://eoriented.github.io/js/main.min.fa5c2b23e07b5d9bfad267a52b4b24fdb053e6fb7524993383594926a3ac270c.js" integrity="sha256-+lwrI+B7XZv60melK0sk/bBT5vt1JJkzg1lJJqOsJww="></script>
</footer>
</nav>
        <div id="content" class="content-container">
        
<h1 class="post-title">스칼라 퓨처(Future)와 동시성(Concurrency) - 2</h1>
    
    <div>
        <p>
        <p><a href="https://eoriented.github.io/post/scala-future-and-concurrency-1/">이전 포스트</a>에 이어서 스칼라 Future의 다른 사용법에 대해 살펴보도록 하겠습니다.</p>
<h2 id="4-future-실패-처리하기">4. Future 실패 처리하기</h2>
<p>스칼라 Future는 실패한 퓨처를 다룰 수 있는 <code>failed</code>, <code>fallBackTo</code>, <code>recover</code>, <code>recoverWith</code> 메소드를 제공합니다.</p>
<h3 id="41-failed">4.1 failed</h3>
<p>Future[T]에서 실패한 Future를 예외를 저장한 Future[Throwable] 타입의 성공한 Future로 바꿔줍니다.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">val</span> failure <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Future</span> <span style="color:#f92672">{</span> <span style="color:#ae81ff">42</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">}</span>
failure<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">scala.concurrent.Future</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">...</span>

scala<span style="color:#f92672">&gt;</span> failure<span style="color:#f92672">.</span>value
res23<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Option</span><span style="color:#f92672">[</span><span style="color:#66d9ef">scala.util.Try</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]]</span> <span style="color:#66d9ef">=</span>
  <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Failure</span><span style="color:#f92672">(</span>java<span style="color:#f92672">.</span>lang<span style="color:#f92672">.</span><span style="color:#a6e22e">ArithmeticException</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">/</span> <span style="color:#66d9ef">by</span> <span style="color:#66d9ef">zero</span><span style="color:#f92672">))</span>

scala<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">val</span> expectedFailure <span style="color:#66d9ef">=</span> failure<span style="color:#f92672">.</span>failed
expectedFailure<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">scala.concurrent.Future</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Throwable</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">...</span>

scala<span style="color:#f92672">&gt;</span> expectedFailure<span style="color:#f92672">.</span>value
res25<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Option</span><span style="color:#f92672">[</span><span style="color:#66d9ef">scala.util.Try</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Throwable</span><span style="color:#f92672">]]</span> <span style="color:#66d9ef">=</span>
  <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Success</span><span style="color:#f92672">(</span>java<span style="color:#f92672">.</span>lang<span style="color:#f92672">.</span><span style="color:#a6e22e">ArithmeticException</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">/</span> <span style="color:#66d9ef">by</span> <span style="color:#66d9ef">zero</span><span style="color:#f92672">))</span>
</code></pre></div><p>만일 성공한 Future에 대해 failed 메소드를 호출하면 NoSuchElementException으로 실패합니다. failed 메소드는 Future가 실패하리라 예상하는 경우에 사용한게 더 적합합니다.</p>
<h3 id="42-fallbackto">4.2 fallbackTo</h3>
<p>fallbackTo를 호출한 Future가 실패한 경우 사용할 수 있는 다른 Future를 지정할 수 있습니다. 실패한 Future 대신 성공한 Future로 바꿔주는 것이죠.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">val</span> fallback <span style="color:#66d9ef">=</span> failure<span style="color:#f92672">.</span>fallbackTo<span style="color:#f92672">(</span>success<span style="color:#f92672">)</span>
fallback<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">scala.concurrent.Future</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">...</span>

scala<span style="color:#f92672">&gt;</span> fallback<span style="color:#f92672">.</span>value
res27<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Option</span><span style="color:#f92672">[</span><span style="color:#66d9ef">scala.util.Try</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]]</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Success</span><span style="color:#f92672">(</span><span style="color:#ae81ff">42</span><span style="color:#f92672">))</span>
</code></pre></div><p>위 예제에서 실패한 failure를 fallbackTo 메소드를 이용해서 성공한 Future로 바꿔주었습니다. 만약 fallbackTo에 전달된 Future도 실패하는 경우에는 fallbackTo 호출한 Future에서 발생한 예외를 가지고 실패합니다. 다음 예를 통해 살펴보겠습니다.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">val</span> failedFallback <span style="color:#66d9ef">=</span> failure<span style="color:#f92672">.</span>fallbackTo<span style="color:#f92672">(</span>
         <span style="color:#a6e22e">Future</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">val</span> res <span style="color:#66d9ef">=</span> <span style="color:#ae81ff">42</span><span style="color:#f92672">;</span> require<span style="color:#f92672">(</span>res <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">);</span> res <span style="color:#f92672">}</span>
        <span style="color:#f92672">)</span>
failedFallback<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">scala.concurrent.Future</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">...</span>

scala<span style="color:#f92672">&gt;</span> failedFallback<span style="color:#f92672">.</span>value
res28<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Option</span><span style="color:#f92672">[</span><span style="color:#66d9ef">scala.util.Try</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]]</span> <span style="color:#66d9ef">=</span>
  <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Failure</span><span style="color:#f92672">(</span>java<span style="color:#f92672">.</span>lang<span style="color:#f92672">.</span><span style="color:#a6e22e">ArithmeticException</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">/</span> <span style="color:#66d9ef">by</span> <span style="color:#66d9ef">zero</span><span style="color:#f92672">))</span>
</code></pre></div><p>위의 예에서 보면 fallbackTo 안에 있는 Future의 경우 <code>IllegalArgumentException</code>을 발생합니다. 그러나 fallbackTo안에 있는 Future의 예외가 아닌 failure Future에서 발생한 <code>ArithmeticException</code>을 발생하는 것을 확인할 수 있습니다.</p>
<h3 id="43-recover">4.3 recover</h3>
<p>recover 메소드를 사용하면 실패한 Future를 성공한 Future로 변환할 수 있습니다. 만일 원래 Future가 성공하면 그 결과는 그대로 유지됩니다. 예를 살펴보겠습니다.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">val</span> recovered <span style="color:#66d9ef">=</span> failedFallback recover <span style="color:#f92672">{</span>
          <span style="color:#66d9ef">case</span> ex<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">ArithmeticException</span> <span style="color:#f92672">=&gt;</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
        <span style="color:#f92672">}</span>
 recovered<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">scala.concurrent.Future</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">...</span>

 scala<span style="color:#f92672">&gt;</span> recovered<span style="color:#f92672">.</span>value
res32<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Option</span><span style="color:#f92672">[</span><span style="color:#66d9ef">scala.util.Try</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]]</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Success</span><span style="color:#f92672">(-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">))</span>
</code></pre></div><p>이전에 살펴보았던 failedFallback는 ArithmeticException을 빌생하는데 해당 예외를 -1로 변환해서 성공한 Future로 변경해줍니다.<br>
만일 원래의 Future가 성공이면 원래의 값을 그대로 리턴해주는데 예를 통해 살펴보겠습니다.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">val</span> unrecovered <span style="color:#66d9ef">=</span> fallback recover <span style="color:#f92672">{</span>
         <span style="color:#66d9ef">case</span> ex<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">ArithmeticException</span> <span style="color:#f92672">=&gt;</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
       <span style="color:#f92672">}</span>
unrecovered<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">scala.concurrent.Future</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">...</span>

scala<span style="color:#f92672">&gt;</span> unrecovered<span style="color:#f92672">.</span>value
res33<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Option</span><span style="color:#f92672">[</span><span style="color:#66d9ef">scala.util.Try</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]]</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Success</span><span style="color:#f92672">(</span><span style="color:#ae81ff">42</span><span style="color:#f92672">))</span>
</code></pre></div><p>위의 예와 같이 원래의 성공한 값을 돌려줍니다.</p>
<h3 id="44-recoverwith">4.4 recoverWith</h3>
<p>recoverWith는 recover 메소드와 비슷합니다. 차이는 recover는 문제가 생기면 값으로 복구하는데 반해, recoverWith는 Future 값으로 복구하는 차이가 있습니다. map과 flatMap의 차이라고 볼 수 있겠습니다.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">val</span> alsoRecovered <span style="color:#66d9ef">=</span> failedFallback recoverWith <span style="color:#f92672">{</span>
         <span style="color:#66d9ef">case</span> ex<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">ArithmeticException</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">Future</span> <span style="color:#f92672">{</span> <span style="color:#ae81ff">42</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">46</span> <span style="color:#f92672">}</span>
       <span style="color:#f92672">}</span>
alsoRecovered<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">scala.concurrent.Future</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">...</span>

scala<span style="color:#f92672">&gt;</span> alsoRecovered<span style="color:#f92672">.</span>value
res35<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Option</span><span style="color:#f92672">[</span><span style="color:#66d9ef">scala.util.Try</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]]</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Success</span><span style="color:#f92672">(</span><span style="color:#ae81ff">88</span><span style="color:#f92672">))</span>
</code></pre></div><p>recover와 마찬가지로 원래의 Future가 실패하지 않는 경우 원래의 값을 반환합니다. 만일 recoverWith에 전달된 부분 함수내에 원래 Future에서 발생한 예외를 정의하지 않는 경우에도 기존 Future에서 발생한 예외가 그대로 전달됩니다.</p>
<h3 id="45-transform">4.5 transform</h3>
<p>Future의 transform 메소드는 Future를 변환하기 위해 두 개의 함수를 받아서 처리합니다. 하나는 Success인 경우의 변환이고, 다른 하나는 Failure에 대한 변환입니다. 먼저 예제를 살펴보도록 하겠습니다.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">val</span> first <span style="color:#66d9ef">=</span> success<span style="color:#f92672">.</span>transform<span style="color:#f92672">(</span>
         res <span style="color:#66d9ef">=&gt;</span> res <span style="color:#f92672">*</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span>
         ex <span style="color:#66d9ef">=&gt;</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Exception</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;see cause&#34;</span><span style="color:#f92672">,</span> ex<span style="color:#f92672">)</span>
       <span style="color:#f92672">)</span>
first<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">scala.concurrent.Future</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">...</span>
</code></pre></div><p>퓨처가 성공하면 첫 번째 함수가 사용되고, 실패하면 두 번째 함수가 사용됩니다. transform 메소드는 성공한 Future를 실패로 만들거나 실패한 Future를 성공으로 변환할 수는 없습니다. 그러나 스칼라 2.12부터 Try를 받아서 Try를 돌려주는 transform 메소드가 추가되었습니다. 다음 예제는 실패를 성공으로 변환하는 예를 보여줍니다.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">val</span> nonNegative <span style="color:#66d9ef">=</span> failure<span style="color:#f92672">.</span>transform <span style="color:#f92672">{</span> <span style="color:#75715e">// Scala 2.12
</span><span style="color:#75715e"></span>         <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Success</span><span style="color:#f92672">(</span>res<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#a6e22e">Success</span><span style="color:#f92672">(</span>res<span style="color:#f92672">.</span>abs <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">)</span>
         <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Failure</span><span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#a6e22e">Success</span><span style="color:#f92672">(</span><span style="color:#ae81ff">0</span><span style="color:#f92672">)</span>
       <span style="color:#f92672">}</span>
nonNegative<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">scala.concurrent.Future</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">...</span>

scala<span style="color:#f92672">&gt;</span> nonNegative<span style="color:#f92672">.</span>value
res11<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Option</span><span style="color:#f92672">[</span><span style="color:#66d9ef">scala.util.Try</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]]</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Success</span><span style="color:#f92672">(</span><span style="color:#ae81ff">0</span><span style="color:#f92672">))</span>
</code></pre></div><h2 id="5-future-조합하기">5. Future 조합하기</h2>
<p>Future의 Companion object에는 여러 Future를 조합할 수 있는 메소드를 제공합니다.</p>
<h3 id="51-zip">5.1 zip</h3>
<p>2개의 성공적인 Future를 2개의 값을 가진 tuple로 만들어줍니다.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">val</span> zippedSuccess <span style="color:#66d9ef">=</span> success zip recovered
zippedSuccess<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">scala.concurrent.Future</span><span style="color:#f92672">[(</span><span style="color:#66d9ef">Int</span>, <span style="color:#66d9ef">Int</span><span style="color:#f92672">)]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">...</span>

scala<span style="color:#f92672">&gt;</span> zippedSuccess<span style="color:#f92672">.</span>value
res46<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Option</span><span style="color:#f92672">[</span><span style="color:#66d9ef">scala.util.Try</span><span style="color:#f92672">[(</span><span style="color:#66d9ef">Int</span>, <span style="color:#66d9ef">Int</span><span style="color:#f92672">)]]</span> <span style="color:#66d9ef">=</span>
     <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Success</span><span style="color:#f92672">((</span><span style="color:#ae81ff">42</span><span style="color:#f92672">,-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">)))</span>
</code></pre></div><p>만일 두 Future 중에 하나라도 실패하면 zip이 반환하는 Future도 같은 예외로 실패합니다. 만약 두 개의 Future가 모두 실패하는 경우에는 zip을 호출한 Future의 예외를 가지고 실패합니다.</p>
<h3 id="52-fold">5.2 fold</h3>
<p>Future의 동반 객체에서 Future의 TraversableOnce 컬렉션 결과를 누적할 수 있는 fold 메소드 제공합니다. 컬렉션 안의 모든 Future가 성공하면 결과 Future도 누적 값을 가지고 성공하지만 컬렉션에 있는 Future 중 하나가 실패하면 결과 Future도 실패합니다. 결과 Future는 가장 먼저 실패한 예외 값을 가지고 실패합니다. fold를 사용하는 예제는 다음과 같습니다.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">val</span> fortyTwo <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Future</span> <span style="color:#f92672">{</span> <span style="color:#ae81ff">21</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">21</span> <span style="color:#f92672">}</span>
fortyTwo<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">scala.concurrent.Future</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">...</span>

scala<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">val</span> fortySix <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Future</span> <span style="color:#f92672">{</span> <span style="color:#ae81ff">23</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">23</span> <span style="color:#f92672">}</span>
fortySix<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">scala.concurrent.Future</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">...</span>

scala<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">val</span> futureNums <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">List</span><span style="color:#f92672">(</span>fortyTwo<span style="color:#f92672">,</span> fortySix<span style="color:#f92672">)</span>
futureNums<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">List</span><span style="color:#f92672">[</span><span style="color:#66d9ef">scala.concurrent.Future</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">...</span>

scala<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">val</span> folded <span style="color:#66d9ef">=</span>
        <span style="color:#a6e22e">Future</span><span style="color:#f92672">.</span>fold<span style="color:#f92672">(</span>futureNums<span style="color:#f92672">)(</span><span style="color:#ae81ff">0</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span> <span style="color:#f92672">(</span>acc<span style="color:#f92672">,</span> num<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span>
          acc <span style="color:#f92672">+</span> num
        <span style="color:#f92672">}</span>
folded<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">scala.concurrent.Future</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">...</span>

scala<span style="color:#f92672">&gt;</span> folded<span style="color:#f92672">.</span>value
res53<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Option</span><span style="color:#f92672">[</span><span style="color:#66d9ef">scala.util.Try</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]]</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Success</span><span style="color:#f92672">(</span><span style="color:#ae81ff">88</span><span style="color:#f92672">))</span>
</code></pre></div><h3 id="53-reduce">5.3 reduce</h3>
<p>Future.reduce 메소드는 초기값 없이 fold를 진행합니다. 대신 초기값으로 첫 번째 Future의 값을 사용합니다.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">val</span> reduced <span style="color:#66d9ef">=</span>
        <span style="color:#a6e22e">Future</span><span style="color:#f92672">.</span>reduce<span style="color:#f92672">(</span>futureNums<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> <span style="color:#f92672">(</span>acc<span style="color:#f92672">,</span> num<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span>
          acc <span style="color:#f92672">+</span> num
        <span style="color:#f92672">}</span>
reduced<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">scala.concurrent.Future</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">...</span>

scala<span style="color:#f92672">&gt;</span> reduced<span style="color:#f92672">.</span>value
res54<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Option</span><span style="color:#f92672">[</span><span style="color:#66d9ef">scala.util.Try</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]]</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Success</span><span style="color:#f92672">(</span><span style="color:#ae81ff">88</span><span style="color:#f92672">))</span>
</code></pre></div><h3 id="54-sequence">5.4 sequence</h3>
<p>Future.sequence 메소드는 Future로 이루어진 TraversableOnce 컬렉션을 TraversableOnce 값이 담긴 Future로 변환해줍니다. 예를 들어 List[Future[Int]]를 Future[List[Int]]로 변환시켜줍니다. 다음은 sequence를 사용하는 예입니다.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">val</span> futureList <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Future</span><span style="color:#f92672">.</span>sequence<span style="color:#f92672">(</span>futureNums<span style="color:#f92672">)</span>
futureList<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">scala.concurrent.Future</span><span style="color:#f92672">[</span><span style="color:#66d9ef">List</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">...</span>

scala<span style="color:#f92672">&gt;</span> futureList<span style="color:#f92672">.</span>value
res55<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Option</span><span style="color:#f92672">[</span><span style="color:#66d9ef">scala.util.Try</span><span style="color:#f92672">[</span><span style="color:#66d9ef">List</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]]]</span> <span style="color:#66d9ef">=</span>
  <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Success</span><span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#ae81ff">42</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">46</span><span style="color:#f92672">)))</span>
</code></pre></div><h3 id="55-traverse">5.5 traverse</h3>
<p>Future.traverse 메소드는 TraversableOnce를 Future의 TraversableOnce로 변환하고, 값의 TraversableOnce를 완료하는 Future로 시퀀스화해줍니다. 다시 말해서 <code>List[Int]</code> -&gt; <code>List[Future[Int]]</code> -&gt; <code>Future[List[Int]]</code>로 바꾸어 처리합니다. 다음 예를 보면 이해가 더 수월하실 것입니다.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">val</span> traversed <span style="color:#66d9ef">=</span>
        <span style="color:#a6e22e">Future</span><span style="color:#f92672">.</span>traverse<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span> i <span style="color:#66d9ef">=&gt;</span> <span style="color:#a6e22e">Future</span><span style="color:#f92672">(</span>i<span style="color:#f92672">)</span> <span style="color:#f92672">}</span>
traversed<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">scala.concurrent.Future</span><span style="color:#f92672">[</span><span style="color:#66d9ef">List</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">...</span>

scala<span style="color:#f92672">&gt;</span> traversed<span style="color:#f92672">.</span>value
res58<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Option</span><span style="color:#f92672">[</span><span style="color:#66d9ef">scala.util.Try</span><span style="color:#f92672">[</span><span style="color:#66d9ef">List</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]]]</span> <span style="color:#66d9ef">=</span>
  <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Success</span><span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">)))</span>
</code></pre></div><h2 id="6-side-effects-처리하기">6. Side-effects 처리하기</h2>
<p>Future가 완료된 다음 side-effect를 수행해야 할 때가 있습니다. 이러한 side-effect를 처리하기 위해서 Future는 다양한 함수를 제공합니다.</p>
<h3 id="61-foreach">6.1 foreach</h3>
<p>Future가 성공적으로 완료된 경우 side-effect를 수행합니다. 다음 예에서 Future가 실패하는 경우 println이 실행되지 않고, 성공한 경우에만 실행됩니다.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> failure<span style="color:#f92672">.</span>foreach<span style="color:#f92672">(</span>ex <span style="color:#66d9ef">=&gt;</span> println<span style="color:#f92672">(</span>ex<span style="color:#f92672">))</span>

scala<span style="color:#f92672">&gt;</span> success<span style="color:#f92672">.</span>foreach<span style="color:#f92672">(</span>res <span style="color:#66d9ef">=&gt;</span> println<span style="color:#f92672">(</span>res<span style="color:#f92672">))</span>
<span style="color:#ae81ff">42</span>
</code></pre></div><p>yield가 없는 for는 foreach로 바뀌기 때문에 for를 사용해도 마찬가지 효과를 얻을 수 있습니다.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>res <span style="color:#66d9ef">&lt;-</span> failure<span style="color:#f92672">)</span> println<span style="color:#f92672">(</span>res<span style="color:#f92672">)</span>

scala<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>res <span style="color:#66d9ef">&lt;-</span> success<span style="color:#f92672">)</span> println<span style="color:#f92672">(</span>res<span style="color:#f92672">)</span>
<span style="color:#ae81ff">42</span>
</code></pre></div><h3 id="62-callback-함수">6.2 callback 함수</h3>
<p>Future는 콜백 함수를 등록하기 위해 두 가지 메소드르 제공합니다. 하나는 onComplete 메소드입니다. onComplete 메소드는 Future의 성공 여부와 관계 없이 완료 시 실행됩니다. callback 함수에는 Try가 전달되므로 성공과 실패 여부에 따라 다르게 처리할 수 있습니다.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> success onComplete <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Success</span><span style="color:#f92672">(</span>res<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> println<span style="color:#f92672">(</span>res<span style="color:#f92672">)</span>
        <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Failure</span><span style="color:#f92672">(</span>ex<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> println<span style="color:#f92672">(</span>ex<span style="color:#f92672">)</span>
      <span style="color:#f92672">}</span>
<span style="color:#ae81ff">42</span>

scala<span style="color:#f92672">&gt;</span> failure onComplete <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Success</span><span style="color:#f92672">(</span>res<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> println<span style="color:#f92672">(</span>res<span style="color:#f92672">)</span>
        <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Failure</span><span style="color:#f92672">(</span>ex<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> println<span style="color:#f92672">(</span>ex<span style="color:#f92672">)</span>
      <span style="color:#f92672">}</span>
java<span style="color:#f92672">.</span>lang<span style="color:#f92672">.</span><span style="color:#a6e22e">ArithmeticException</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">/</span> <span style="color:#66d9ef">by</span> <span style="color:#66d9ef">zero</span>
</code></pre></div><p>Future는 onComplete로 등록한 콜백 함수의 실행 순서에 대해 아무것도 보장해주지 않습니다. 이렇게 콜백 함수의 호출되는 순서를 보장하고 싶다면 andThen 메소드를 대신 사용해야 합니다. andThen 메소드는 andThen을 호출한 Future를 그대로 반영하는 새로운 Future를 반환합니다. 그러나 콜백 함수가 완전히 실행될 때까지는 완료되지 않습니다.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">val</span> newFuture <span style="color:#66d9ef">=</span> success andThen <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Success</span><span style="color:#f92672">(</span>res<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> println<span style="color:#f92672">(</span>res<span style="color:#f92672">)</span>
        <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Failure</span><span style="color:#f92672">(</span>ex<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> println<span style="color:#f92672">(</span>ex<span style="color:#f92672">)</span>
      <span style="color:#f92672">}</span>
<span style="color:#ae81ff">42</span>
newFuture<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">scala.concurrent.Future</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">...</span>

scala<span style="color:#f92672">&gt;</span> newFuture<span style="color:#f92672">.</span>value
res76<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Option</span><span style="color:#f92672">[</span><span style="color:#66d9ef">scala.util.Try</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]]</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Success</span><span style="color:#f92672">(</span><span style="color:#ae81ff">42</span><span style="color:#f92672">))</span>
</code></pre></div><h2 id="7-scala-212에-추가된-메소드">7. scala 2.12에 추가된 메소드</h2>
<h3 id="71-flatten">7.1 flatten</h3>
<p>flatten은 Future[Future[Int]]를 Future[Int]로 변환해줍니다.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">val</span> nestedFuture <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Future</span> <span style="color:#f92672">{</span> <span style="color:#a6e22e">Future</span> <span style="color:#f92672">{</span> <span style="color:#ae81ff">42</span> <span style="color:#f92672">}</span> <span style="color:#f92672">}</span>
nestedFuture<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Future</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Future</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">...</span>

scala<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">val</span> flattened <span style="color:#66d9ef">=</span> nestedFuture<span style="color:#f92672">.</span>flatten <span style="color:#75715e">// Scala 2.12
</span><span style="color:#75715e"></span>flattened<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">scala.concurrent.Future</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Future</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Success</span><span style="color:#f92672">(</span><span style="color:#ae81ff">42</span><span style="color:#f92672">))</span>
</code></pre></div><h3 id="72-zipwith">7.2 zipWith</h3>
<p>zipWith 메소드는 2개의 Future를 묶는 zip과 map을 조합한 메소드입니다.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">val</span> futNum <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Future</span> <span style="color:#f92672">{</span> <span style="color:#ae81ff">21</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">21</span> <span style="color:#f92672">}</span>
futNum<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">scala.concurrent.Future</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">...</span>

scala<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">val</span> futStr <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Future</span> <span style="color:#f92672">{</span> <span style="color:#e6db74">&#34;ans&#34;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;wer&#34;</span> <span style="color:#f92672">}</span>
futStr<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">scala.concurrent.Future</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">...</span>

scala<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">val</span> zipped <span style="color:#66d9ef">=</span> futNum zip futStr
zipped<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">scala.concurrent.Future</span><span style="color:#f92672">[(</span><span style="color:#66d9ef">Int</span>, <span style="color:#66d9ef">String</span><span style="color:#f92672">)]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">...</span>

scala<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">val</span> mapped <span style="color:#66d9ef">=</span> zipped map <span style="color:#f92672">{</span>
         <span style="color:#66d9ef">case</span> <span style="color:#f92672">(</span>num<span style="color:#f92672">,</span> str<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#e6db74">s&#34;</span><span style="color:#e6db74">$num</span><span style="color:#e6db74"> is the </span><span style="color:#e6db74">$str</span><span style="color:#e6db74">&#34;</span>
       <span style="color:#f92672">}</span>
mapped<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">scala.concurrent.Future</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">...</span>

scala<span style="color:#f92672">&gt;</span> mapped<span style="color:#f92672">.</span>value
res2<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Option</span><span style="color:#f92672">[</span><span style="color:#66d9ef">scala.util.Try</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]]</span> <span style="color:#66d9ef">=</span>
    <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Success</span><span style="color:#f92672">(</span><span style="color:#ae81ff">42</span> is the answer<span style="color:#f92672">))</span>
</code></pre></div><p>위의 예는 zip과 map을 조합하여 사용한 방식입니다. zipWith를 사용하면 더 간결하게 표현할 수 있습니다.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">val</span> fut <span style="color:#66d9ef">=</span> futNum<span style="color:#f92672">.</span>zipWith<span style="color:#f92672">(</span>futStr<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> <span style="color:#75715e">// Scala 2.12
</span><span style="color:#75715e"></span>         <span style="color:#66d9ef">case</span> <span style="color:#f92672">(</span>num<span style="color:#f92672">,</span> str<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#e6db74">s&#34;</span><span style="color:#e6db74">$num</span><span style="color:#e6db74"> is the </span><span style="color:#e6db74">$str</span><span style="color:#e6db74">&#34;</span>
       <span style="color:#f92672">}</span>
zipWithed<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">scala.concurrent.Future</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">...</span>

scala<span style="color:#f92672">&gt;</span> fut<span style="color:#f92672">.</span>value
res3<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Option</span><span style="color:#f92672">[</span><span style="color:#66d9ef">scala.util.Try</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]]</span> <span style="color:#66d9ef">=</span>
    <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Success</span><span style="color:#f92672">(</span><span style="color:#ae81ff">42</span> is the answer<span style="color:#f92672">))</span>
</code></pre></div><h3 id="73-transformwith">7.3 transformWith</h3>
<p>transformWith 메소드를 이용해서 Future를 얻을 수 있습니다. transformWith는 transform 메소드와 유사하지만 transform에 전달하는 함수는 Try를 만들어내지만, transformWith는 Future를 만들어낸다는 점이 다릅니다.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">val</span> flipped <span style="color:#66d9ef">=</span> success<span style="color:#f92672">.</span>transformWith <span style="color:#f92672">{</span> <span style="color:#75715e">// Scala 2.12
</span><span style="color:#75715e"></span>         <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Success</span><span style="color:#f92672">(</span>res<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span>
           <span style="color:#a6e22e">Future</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Exception</span><span style="color:#f92672">(</span>res<span style="color:#f92672">.</span>toString<span style="color:#f92672">)</span> <span style="color:#f92672">}</span>
         <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Failure</span><span style="color:#f92672">(</span>ex<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#a6e22e">Future</span> <span style="color:#f92672">{</span> <span style="color:#ae81ff">21</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">21</span> <span style="color:#f92672">}</span>
       <span style="color:#f92672">}</span>
flipped<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">scala.concurrent.Future</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">...</span>

scala<span style="color:#f92672">&gt;</span> flipped<span style="color:#f92672">.</span>value
res5<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Option</span><span style="color:#f92672">[</span><span style="color:#66d9ef">scala.util.Try</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]]</span> <span style="color:#66d9ef">=</span>
     <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Failure</span><span style="color:#f92672">(</span>java<span style="color:#f92672">.</span>lang<span style="color:#f92672">.</span><span style="color:#a6e22e">Exception</span><span style="color:#66d9ef">:</span> <span style="color:#960050;background-color:#1e0010">42</span><span style="color:#f92672">))</span>
</code></pre></div><p>스칼라의 Future는 동시성 프로그래밍을 간결하게 할 수 있는 강력한 도구입니다. 이를 사용하면 코드를 단순화하면서 멀티 프로세서의 이점을 누릴 수 있습니다. 기존의 동시성 프로그래밍을 지원하기 위한 스레드, 락, 모니터는 데드락과 레이스 컨디션을 처리하기 어려운 문제가 있었습니다. 그러나 Future는 데드락이나 레이스 컨디션의 큰 위험 없이도 동시성 프로그램을 작성할 수 있게 해줍니다. 이번 포스팅에서는 Future의 생성, 변환 등 Future를 사용하기 위한 기본적인 요소들에 대해 살펴보았습니다.</p>
<h2 id="reference">Reference</h2>
<ul>
<li><a href="https://www.aladin.co.kr/shop/wproduct.aspx?ISBN=8960777730&amp;start=pnaver_02">Programming in Scala</a></li>
</ul>

        </p>

        <br />
        <br />

        <div class="paging post-paging" style="margin-bottom: 15px;">
            
            
            <div style="text-align: left">
                <a class="left" href="https://eoriented.github.io/post/scala-future-and-concurrency-1/" rel="prev" style="color: #64BEA3">
                    <i class="fa fa-play fa-rotate-180" aria-hidden="true"></i>&nbsp;&nbsp;<span>스칼라 퓨처(Future)와 동시성(Concurrency) - 1</span>
                </a>
            </div>
            
            
            
        </div>
    </div>

    
    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "smart-tiger" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    

    <div class="page-footer">
        
        <hr class="footer-divider">
        
            <a class="tag" href="https://eoriented.github.io/tags/future">#Future</a>
        
            <a class="tag" href="https://eoriented.github.io/tags/%EB%8F%99%EC%8B%9C%EC%84%B1">#동시성</a>
        
            <a class="tag" href="https://eoriented.github.io/tags/%EB%B9%84%EB%8F%99%EA%B8%B0">#비동기</a>
        
            <a class="tag" href="https://eoriented.github.io/tags/%EB%B9%84%EB%8F%99%EA%B8%B0%EC%B2%98%EB%A6%AC">#비동기처리</a>
        
            <a class="tag" href="https://eoriented.github.io/tags/thread">#thread</a>
        
      
    </div>


        
        </div>
        <footer class="footer-mobile">
	<div class="social-icons" style="text-align: center">
    
    <a class="social-icon" href="https://github.com/eoriented" target="_blank" rel="noopener" title="GitHub">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M13.9988029,1.32087331 C6.82105037,1.32087331 1,7.14112562 1,14.3212723 C1,20.0649109 4.72454649,24.9370678 9.89038951,26.6560892 C10.5408085,26.7757983 10.7778323,26.374374 10.7778323,26.0296121 C10.7778323,25.7215609 10.7666595,24.9035493 10.760275,23.8189856 C7.14426471,24.6042767 6.38131925,22.0760223 6.38131925,22.0760223 C5.78995672,20.5740732 4.93762853,20.1742451 4.93762853,20.1742451 C3.75729765,19.3682044 5.02701126,19.3841656 5.02701126,19.3841656 C6.33183953,19.4759425 7.01817121,20.7241085 7.01817121,20.7241085 C8.17775254,22.7104801 10.0611744,22.1366749 10.8017741,21.8038838 C10.919887,20.9643246 11.2558703,20.3913175 11.6269683,20.066507 C8.74038491,19.7385043 5.70536235,18.6228163 5.70536235,13.6413251 C5.70536235,12.2223743 6.21213051,11.0611968 7.04370914,10.1530044 C6.90963504,9.82420367 6.46351945,8.50181809 7.17139875,6.71256734 C7.17139875,6.71256734 8.26234691,6.36301702 10.7459099,8.04532771 C11.78259,7.75642995 12.8950858,7.61277914 14.000399,7.60719272 C15.1049142,7.61277914 16.2166119,7.75642995 17.2548881,8.04532771 C19.736855,6.36301702 20.8262071,6.71256734 20.8262071,6.71256734 C21.5356825,8.50181809 21.0895669,9.82420367 20.9562909,10.1530044 C21.7894656,11.0611968 22.2922435,12.2223743 22.2922435,13.6413251 C22.2922435,18.6355852 19.2524325,19.734514 16.3570705,20.0561322 C16.8231376,20.4575564 17.2389269,21.2508282 17.2389269,22.4638795 C17.2389269,24.2012564 17.2229657,25.603448 17.2229657,26.0296121 C17.2229657,26.3775663 17.4575954,26.7821827 18.116793,26.6552912 C23.2786458,24.9322794 27,20.0633148 27,14.3212723 C27,7.14112562 21.1789496,1.32087331 13.9988029,1.32087331"></path>
        </svg>
    </a>
    

    
    <a class="social-icon" href="https://www.linkedin.com/in/kimminho" target="_blank" rel="noopener" title="LinkedIn">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M2,3.654102 C2,2.69908141 2.79442509,1.92397846 3.77383592,1.92397846 L24.2261641,1.92397846 C25.2058917,1.92397846 26,2.69908141 26,3.654102 L26,24.3462148 C26,25.3015521 25.2058917,26.0760215 24.2261641,26.0760215 L3.77383592,26.0760215 C2.79442509,26.0760215 2,25.3015521 2,24.3465315 L2,3.65378524 L2,3.654102 Z M9.27526132,22.1415901 L9.27526132,11.2356668 L5.65030092,11.2356668 L5.65030092,22.1415901 L9.27557808,22.1415901 L9.27526132,22.1415901 Z M7.46341463,9.74691162 C8.72727273,9.74691162 9.51409566,8.90940767 9.51409566,7.86284447 C9.49033893,6.79252455 8.72727273,5.97846056 7.48748812,5.97846056 C6.24675325,5.97846056 5.43649034,6.79252455 5.43649034,7.86284447 C5.43649034,8.90940767 6.22299652,9.74691162 7.4396579,9.74691162 L7.46309788,9.74691162 L7.46341463,9.74691162 Z M11.2815965,22.1415901 L14.9062401,22.1415901 L14.9062401,16.0519481 C14.9062401,15.7263225 14.9299968,15.4000634 15.0256573,15.1675641 C15.2876148,14.5159962 15.8840672,13.8416218 16.8856509,13.8416218 C18.1970225,13.8416218 18.7218879,14.8416218 18.7218879,16.3078872 L18.7218879,22.1415901 L22.3465315,22.1415901 L22.3465315,15.8885017 C22.3465315,12.5388027 20.5584416,10.9800443 18.1735825,10.9800443 C16.2182452,10.9800443 15.3595185,12.072854 14.8824834,12.8172315 L14.9065569,12.8172315 L14.9065569,11.2359835 L11.2819132,11.2359835 C11.3291099,12.2591067 11.2815965,22.1419069 11.2815965,22.1419069 L11.2815965,22.1415901 Z"></path>
        </svg>
    </a>
    

    
    <a class="social-icon" href="mailto:eoriented@gmail.com" target="_blank" rel="noopener" title="Email">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M25.2794292,5.59128519 L14,16.8707144 L2.72057081,5.59128519 C3.06733103,5.30237414 3.51336915,5.12857603 4,5.12857603 L24,5.12857603 C24.4866308,5.12857603 24.932669,5.30237414 25.2794292,5.59128519 Z M25.9956978,6.99633695 C25.998551,7.04004843 26,7.08414302 26,7.12857603 L26,20.871424 C26,21.0798433 25.9681197,21.2808166 25.9089697,21.4697335 L18.7156355,14.2763993 L25.9956978,6.99633695 Z M24.9498374,22.6319215 C24.6672737,22.7846939 24.3437653,22.871424 24,22.871424 L4,22.871424 C3.5268522,22.871424 3.09207889,22.7071233 2.74962118,22.432463 L10.0950247,15.0870594 L13.9848068,18.9768415 L14.1878486,18.7737996 L14.2030419,18.7889929 L17.6549753,15.3370594 L24.9498374,22.6319215 Z M2.00810114,21.0526627 C2.00273908,20.9929669 2,20.9325153 2,20.871424 L2,7.12857603 C2,7.08414302 2.00144896,7.04004843 2.00430222,6.99633695 L9.03436454,14.0263993 L2.00810114,21.0526627 Z"></path>
        </svg>
    </a>
    

    
    <a class="social-icon" href="https://eoriented.github.io/index.xml" target="_blank" rel="noopener" type="application/rss+xml" title="Rss">
        <svg width="28px" height="28px" viewBox="0 0 8 8" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <circle xmlns="http://www.w3.org/2000/svg" class="symbol" cx="2" cy="6" r="1"/>
            <path xmlns="http://www.w3.org/2000/svg" class="symbol" d="m 1,4 a 3,3 0 0 1 3,3 h 1 a 4,4 0 0 0 -4,-4 z"/>
            <path xmlns="http://www.w3.org/2000/svg" class="symbol" d="m 1,2 a 5,5 0 0 1 5,5 h 1 a 6,6 0 0 0 -6,-6 z"/>
        </svg>
    </a>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    
    

    
</div>




	
		
		
		
	

	<script src="https://eoriented.github.io/js/main.min.fa5c2b23e07b5d9bfad267a52b4b24fdb053e6fb7524993383594926a3ac270c.js" integrity="sha256-+lwrI+B7XZv60melK0sk/bBT5vt1JJkzg1lJJqOsJww="></script>
</footer>
    </body>
</html>