<!DOCTYPE html>

<html lang="ko-KR">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="format-detection" content="telephone=no"/>

    <title>Smart Tiger&#39;s blog</title>
    
    <link rel="apple-touch-icon" sizes="180x180" href="https://eoriented.github.io/apple-touch-icon.png">
    
    
    <link rel="icon" type="image/png" sizes="16x16" href="https://eoriented.github.io/favicon.ico">
    <link rel="manifest" href="https://eoriented.github.io/manifest.json">
    <link rel="mask-icon" href="https://eoriented.github.io/safari-pinned-tab.svg" color="#FF3DB4">
    <meta name="theme-color" content="#ffffff">

    
    
    
    <link rel="stylesheet" href="https://eoriented.github.io/css/main.min.a72ffd9940ffe0d37baca976bc2f5746f5a324465ebb022c4aa544afed426f4c.css"/>

    
    
    

    
    
 
    
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-160052384-1', 'auto');
	
	ga('send', 'pageview');
}
</script>


    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
  });
  MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script> 
</head>
    <body>
        
<nav>
  <header>
    <div class="site-title">
        
        <a href="https://eoriented.github.io/">
        <img style="display: block; margin: 0px auto" width="90%" src="https://eoriented.github.io/images/logo2.png" /></a>
    </div>  
</header>
  <div class="nav-menu">
  
    <a class="color-link nav-link" href="https://eoriented.github.io/categories/bigdata/">Big data</a>
  
    <a class="color-link nav-link" href="https://eoriented.github.io/categories/machine-learning/">Machine learning</a>
  
    <a class="color-link nav-link" href="https://eoriented.github.io/categories/programming/">Programming</a>
  
    <a class="color-link nav-link" href="https://eoriented.github.io/categories/cloud/">Cloud</a>
  
    <a class="color-link nav-link" href="https://eoriented.github.io/categories/tools/">Tools</a>
  
    <a class="color-link nav-link" href="https://eoriented.github.io/categories/">Categories</a>
  
    <a class="color-link nav-link" href="https://eoriented.github.io/tags/">Tags</a>
  
  
</div>
<footer class="footer">
	<div class="social-icons" style="text-align: center">
    
    <a class="social-icon" href="https://github.com/eoriented" target="_blank" rel="noopener" title="GitHub">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M13.9988029,1.32087331 C6.82105037,1.32087331 1,7.14112562 1,14.3212723 C1,20.0649109 4.72454649,24.9370678 9.89038951,26.6560892 C10.5408085,26.7757983 10.7778323,26.374374 10.7778323,26.0296121 C10.7778323,25.7215609 10.7666595,24.9035493 10.760275,23.8189856 C7.14426471,24.6042767 6.38131925,22.0760223 6.38131925,22.0760223 C5.78995672,20.5740732 4.93762853,20.1742451 4.93762853,20.1742451 C3.75729765,19.3682044 5.02701126,19.3841656 5.02701126,19.3841656 C6.33183953,19.4759425 7.01817121,20.7241085 7.01817121,20.7241085 C8.17775254,22.7104801 10.0611744,22.1366749 10.8017741,21.8038838 C10.919887,20.9643246 11.2558703,20.3913175 11.6269683,20.066507 C8.74038491,19.7385043 5.70536235,18.6228163 5.70536235,13.6413251 C5.70536235,12.2223743 6.21213051,11.0611968 7.04370914,10.1530044 C6.90963504,9.82420367 6.46351945,8.50181809 7.17139875,6.71256734 C7.17139875,6.71256734 8.26234691,6.36301702 10.7459099,8.04532771 C11.78259,7.75642995 12.8950858,7.61277914 14.000399,7.60719272 C15.1049142,7.61277914 16.2166119,7.75642995 17.2548881,8.04532771 C19.736855,6.36301702 20.8262071,6.71256734 20.8262071,6.71256734 C21.5356825,8.50181809 21.0895669,9.82420367 20.9562909,10.1530044 C21.7894656,11.0611968 22.2922435,12.2223743 22.2922435,13.6413251 C22.2922435,18.6355852 19.2524325,19.734514 16.3570705,20.0561322 C16.8231376,20.4575564 17.2389269,21.2508282 17.2389269,22.4638795 C17.2389269,24.2012564 17.2229657,25.603448 17.2229657,26.0296121 C17.2229657,26.3775663 17.4575954,26.7821827 18.116793,26.6552912 C23.2786458,24.9322794 27,20.0633148 27,14.3212723 C27,7.14112562 21.1789496,1.32087331 13.9988029,1.32087331"></path>
        </svg>
    </a>
    

    

    
    <a class="social-icon" href="mailto:eoriented@gmail.com" target="_blank" rel="noopener" title="Email">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M25.2794292,5.59128519 L14,16.8707144 L2.72057081,5.59128519 C3.06733103,5.30237414 3.51336915,5.12857603 4,5.12857603 L24,5.12857603 C24.4866308,5.12857603 24.932669,5.30237414 25.2794292,5.59128519 Z M25.9956978,6.99633695 C25.998551,7.04004843 26,7.08414302 26,7.12857603 L26,20.871424 C26,21.0798433 25.9681197,21.2808166 25.9089697,21.4697335 L18.7156355,14.2763993 L25.9956978,6.99633695 Z M24.9498374,22.6319215 C24.6672737,22.7846939 24.3437653,22.871424 24,22.871424 L4,22.871424 C3.5268522,22.871424 3.09207889,22.7071233 2.74962118,22.432463 L10.0950247,15.0870594 L13.9848068,18.9768415 L14.1878486,18.7737996 L14.2030419,18.7889929 L17.6549753,15.3370594 L24.9498374,22.6319215 Z M2.00810114,21.0526627 C2.00273908,20.9929669 2,20.9325153 2,20.871424 L2,7.12857603 C2,7.08414302 2.00144896,7.04004843 2.00430222,6.99633695 L9.03436454,14.0263993 L2.00810114,21.0526627 Z"></path>
        </svg>
    </a>
    

    
    <a class="social-icon" href="https://eoriented.github.io/index.xml" target="_blank" rel="noopener" type="application/rss+xml" title="Rss">
        <svg width="28px" height="28px" viewBox="0 0 8 8" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <circle xmlns="http://www.w3.org/2000/svg" class="symbol" cx="2" cy="6" r="1"/>
            <path xmlns="http://www.w3.org/2000/svg" class="symbol" d="m 1,4 a 3,3 0 0 1 3,3 h 1 a 4,4 0 0 0 -4,-4 z"/>
            <path xmlns="http://www.w3.org/2000/svg" class="symbol" d="m 1,2 a 5,5 0 0 1 5,5 h 1 a 6,6 0 0 0 -6,-6 z"/>
        </svg>
    </a>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    
    

    
</div>




	
	

	<script src="https://eoriented.github.io/js/main.min.fa5c2b23e07b5d9bfad267a52b4b24fdb053e6fb7524993383594926a3ac270c.js" integrity="sha256-+lwrI+B7XZv60melK0sk/bBT5vt1JJkzg1lJJqOsJww="></script>
</footer>
</nav>
        <div id="content" class="content-container">
        
<h1 class="post-title">스칼라 퓨처(Future)와 동시성(Concurrency) - 1</h1>
    
    <div>
        <p>
        <p>오늘 멀티 코어 프로세서가 대중화되면서 동시성에 대한 관심도 많이 늘어났습니다. 이러한 동시성 프로그래밍을 위해서 기존의 프로그래밍 언어들을 블로킹을 사용하여 동기화함으로써 동시성을 지원합니다. 자바의 경우도 마찬가지로 공유 메모리와 락을 기반으로 동시성을 지원하고 있습니다. 그러나 이러한 블로킹을 사용한 동기화의 경우 Deadlock이나 Starvation과 같은 문제가 발생할 수 있습니다. 이렇게 블로킹 기반의 동시성 처리는 이러한 어려움이 있습니다. 그래서 비동기적 프로그래밍을 사용하면 이러한 블로킹을 없앨 수 있습니다. 비동기적(asynchronous) 프로그래밍이란 아래의 그림과 같이 메인 프로그램의 흐름이 있고 이와 독립적으로 실행되는 프로그래밍 스타일을 의미합니다.</p>
<figure >
<a href="https://medium.com/@santhoshhari/efficient-web-scraping-with-pythons-asynchronous-programming-6b9e730f1ff7" target="_blank">
  <img src="https://eoriented.github.io/images/scala-future-and-concurrency-1/sync-and-async.png" width="100%"  style="max-width: 700px" />
  </a>

</figure>
<p>스칼라에서는 이러한 비동기적 프로그래밍을 지원하기 위해 Future라는 것을 지원합니다. Future는 스칼라의 표준라이브러리로써 Future를 사용해 변경 불가능한 상태를 비동기적으로 변환하여 블로킹 방식의 동시성 처리의 어려움을 피할 수 있게 해줍니다.<br>
자바에도 Future가 있지만 스칼라의 Future와 다릅니다. 두 Future 모드 비동기적인 연산의 결과를 표현하지만 자바의 경우 블로킹 방식의 get()을 사용해 결과를 얻어와야 합니다. 오히려 자바 8에 추가된 CompletableFuture가 스칼라의 Future와 비슷합니다. CompletableFuture를 정의하고 그 값을 얻었을 때 행동을 정의할 수 있습니다.<br>
반면 스칼라의 Future는 이미 연산 결과의 완료 여부와 관계 없이 결과 값의 변환을 지정할 수 있습니다. Future의 연산을 수행하는 스레드는 암시적으로 제공되는 Execution context를 사용해 결정됩니다. 이러한 방식을 사용해서 불변 값에 대한 일련의 변환으로 비동기적 연산을 표현할 수 있고, 공유 메모리나 락에 대해 신경 쓸 필요가 없는 장점이 있습니다.</p>
<h2 id="1-낙원의-곤경">1. 낙원의 곤경</h2>
<p>공유 데이터와 락 모델을 사용해 멀티 스레드 애플리케이션을 신뢰성 있게 구축하기가 어렵습니다. 프로그램의 각 위치에서 접근하거나 변경하는 데이터 중 어떤 것을 다른 스레드가 변경하거나 접근할 수 있는지를 추론하고, 어떤 락을 현재 가지고 있는지 알아야 합니다. 거기다가 더 어려운점은 프로그램이 실행되는 도중에 새로운 락을 얼마든지 만들 수 있습니다. 즉, 락이 컴파일 시점에 고정되지 않는다는 점이죠.<br>
자바의 java.util.concurrent 라이브러리는 고수준의 동시성 프로그래밍 추상화를 제공해서 저수준의 공유 데이터와 락 모델을 사용하는 것보다는 오류의 여지가 적지만 마찬가지로 내부적으로 공유 데이터와 락 모델을 사용하기 때문에 해당 문제의 근본적인 어려움을 해소하긴 어렵습니다.<br>
스칼라의 Future는 공유 데이터와 락의 필요성을 줄여주는 동시성 처리 방식을 제공합니다. 물론 Future가 모든 것을 해결할 수 있는 도깨비 방망이는 아닙니다. 하지만 위에서 발생하는 문제를 더욱 간단하게 해줍니다.</p>
<h2 id="2-비동기-실행과-try">2. 비동기 실행과 Try</h2>
<p>스칼라에서 메소드를 호출하고 그 결과가 Future라면 그것을 비동기적으로 진행할 다른 연산을 표현하는 것입니다. 이러한 Future를 실행하기 위해서는 암시적인 execution context가 필요합니다.<br>
Future에는 isCompleted와 value 메소드를 통해서 polling 기능을 제공합니다. value 메소드의 경우 Option[Try[T]]의 값을 리턴합니다. Try는 성공을 나타내는 Success와 예외가 들어있는 실패를 나타내는 Failure 중에 하나를 표현합니다. Try의 목적은 동기적 계산이 있는 try 식이 하는 역할을 비동기 연산을 할 때 동일한 기능을 제공해주는 역할을 합니다. Try의 계층 구조는 아래의 그림과 같습니다.</p>
<figure >
<a href="https://jaxenter.com/cheat-sheet-complete-guide-scala-136558.html" target="_blank">
  <img src="https://eoriented.github.io/images/scala-future-and-concurrency-1/try.png" width="100%"  style="max-width: 550px" />
  </a>

</figure>
<p>동기적 연산에서는 try/catch 구문으로 메소드가 던지는 예외를 그 메소드를 실행하는 스레드에서 잡을 수 있습니다. 그러나 비동기적 연산에서는 연산을 시작한 스레드가 다른 작을 계속 진행하는 경우가 있습니다. 그래서 비동기적 연산에서는 Try 객체를 사용해서 예외가 발생하여 갑자기 종료되는 상황에 대비할 수 있습니다.</p>
<h2 id="3-future의-사용">3. Future의 사용</h2>
<h3 id="31-map">3.1 map</h3>
<p>map을 사용해 Future의 연산 결과를 비동기적으로 변환할 수 있다.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#666">&gt;</span> <span style="color:#007020;font-weight:bold">val</span> fut <span style="color:#007020;font-weight:bold">=</span> <span style="color:#0e84b5;font-weight:bold">Future</span> <span style="color:#666">{</span> <span style="color:#0e84b5;font-weight:bold">Thread</span><span style="color:#666">.</span>sleep<span style="color:#666">(</span><span style="color:#40a070">10000</span><span style="color:#666">);</span> <span style="color:#40a070">21</span> <span style="color:#666">+</span> <span style="color:#40a070">21</span> <span style="color:#666">}</span>
fut<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">scala.concurrent.Future</span><span style="color:#666">[</span><span style="color:#902000">Int</span><span style="color:#666">]</span> <span style="color:#007020;font-weight:bold">=</span> <span style="color:#666">...</span>

scala<span style="color:#666">&gt;</span> <span style="color:#007020;font-weight:bold">val</span> result <span style="color:#007020;font-weight:bold">=</span> fut<span style="color:#666">.</span>map<span style="color:#666">(</span>x <span style="color:#007020;font-weight:bold">=&gt;</span> x <span style="color:#666">+</span> <span style="color:#40a070">1</span><span style="color:#666">)</span>
result<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">scala.concurrent.Future</span><span style="color:#666">[</span><span style="color:#902000">Int</span><span style="color:#666">]</span> <span style="color:#007020;font-weight:bold">=</span> <span style="color:#666">...</span>

scala<span style="color:#666">&gt;</span> result<span style="color:#666">.</span>value
res6<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">Option</span><span style="color:#666">[</span><span style="color:#902000">scala.util.Try</span><span style="color:#666">[</span><span style="color:#902000">Int</span><span style="color:#666">]]</span> <span style="color:#007020;font-weight:bold">=</span> <span style="color:#0e84b5;font-weight:bold">Some</span><span style="color:#666">(</span><span style="color:#0e84b5;font-weight:bold">Success</span><span style="color:#666">(</span><span style="color:#40a070">43</span><span style="color:#666">))</span>
</code></pre></div><p>위의 예제에서 Future의 생성, 21 + 21 계산, 42 + 1 계산이 다른 세가지 스레드에서 실행됩니다.</p>
<h3 id="32-for-문으로-future-변환하기">3.2 for 문으로 Future 변환하기</h3>
<p>Future에는 flatMap의 정의도 들어있기 때문에 for 표현식을 통해 Future를 변환할 수 있습니다.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#666">&gt;</span> <span style="color:#007020;font-weight:bold">val</span> fut1 <span style="color:#007020;font-weight:bold">=</span> <span style="color:#0e84b5;font-weight:bold">Future</span> <span style="color:#666">{</span> <span style="color:#0e84b5;font-weight:bold">Thread</span><span style="color:#666">.</span>sleep<span style="color:#666">(</span><span style="color:#40a070">10000</span><span style="color:#666">);</span> <span style="color:#40a070">21</span> <span style="color:#666">+</span> <span style="color:#40a070">21</span> <span style="color:#666">}</span>
fut1<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">scala.concurrent.Future</span><span style="color:#666">[</span><span style="color:#902000">Int</span><span style="color:#666">]</span> <span style="color:#007020;font-weight:bold">=</span> <span style="color:#666">...</span>

scala<span style="color:#666">&gt;</span> <span style="color:#007020;font-weight:bold">val</span> fut2 <span style="color:#007020;font-weight:bold">=</span> <span style="color:#0e84b5;font-weight:bold">Future</span> <span style="color:#666">{</span> <span style="color:#0e84b5;font-weight:bold">Thread</span><span style="color:#666">.</span>sleep<span style="color:#666">(</span><span style="color:#40a070">10000</span><span style="color:#666">);</span> <span style="color:#40a070">23</span> <span style="color:#666">+</span> <span style="color:#40a070">23</span> <span style="color:#666">}</span>
fut2<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">scala.concurrent.Future</span><span style="color:#666">[</span><span style="color:#902000">Int</span><span style="color:#666">]</span> <span style="color:#007020;font-weight:bold">=</span> <span style="color:#666">...</span>

scala<span style="color:#666">&gt;</span> <span style="color:#007020;font-weight:bold">for</span> <span style="color:#666">{</span>
        x <span style="color:#007020;font-weight:bold">&lt;-</span> fut1
        y <span style="color:#007020;font-weight:bold">&lt;-</span> fut2
      <span style="color:#666">}</span> <span style="color:#007020;font-weight:bold">yield</span> x <span style="color:#666">+</span> y
res7<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">scala.concurrent.Future</span><span style="color:#666">[</span><span style="color:#902000">Int</span><span style="color:#666">]</span> <span style="color:#007020;font-weight:bold">=</span> <span style="color:#666">...</span>

scala<span style="color:#666">&gt;</span> result<span style="color:#666">.</span>value
res8<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">Option</span><span style="color:#666">[</span><span style="color:#902000">scala.util.Try</span><span style="color:#666">[</span><span style="color:#902000">Int</span><span style="color:#666">]]</span> <span style="color:#007020;font-weight:bold">=</span> <span style="color:#0e84b5;font-weight:bold">Some</span><span style="color:#666">(</span><span style="color:#0e84b5;font-weight:bold">Success</span><span style="color:#666">(</span><span style="color:#40a070">88</span><span style="color:#666">))</span>
</code></pre></div><p>위와 다르게 두 Future를 미리 만들지 않은 경우 그 두 Future는 병렬실행되지 않으므로 다음 for 문의 최소 20초가 걸립니다. 그와 다르게 미리 생성한 이전의 예제는 완료되기까지 10여초가 걸립니다.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#666">&gt;</span> <span style="color:#007020;font-weight:bold">for</span> <span style="color:#666">{</span>
        x <span style="color:#007020;font-weight:bold">&lt;-</span> <span style="color:#0e84b5;font-weight:bold">Future</span> <span style="color:#666">{</span> <span style="color:#0e84b5;font-weight:bold">Thread</span><span style="color:#666">.</span>sleep<span style="color:#666">(</span><span style="color:#40a070">10000</span><span style="color:#666">);</span> <span style="color:#40a070">21</span> <span style="color:#666">+</span> <span style="color:#40a070">21</span> <span style="color:#666">}</span>
        y <span style="color:#007020;font-weight:bold">&lt;-</span> <span style="color:#0e84b5;font-weight:bold">Future</span> <span style="color:#666">{</span> <span style="color:#0e84b5;font-weight:bold">Thread</span><span style="color:#666">.</span>sleep<span style="color:#666">(</span><span style="color:#40a070">10000</span><span style="color:#666">);</span> <span style="color:#40a070">23</span> <span style="color:#666">+</span> <span style="color:#40a070">23</span> <span style="color:#666">}</span>
      <span style="color:#666">}</span> <span style="color:#007020;font-weight:bold">yield</span> x <span style="color:#666">+</span> y
res9<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">scala.concurrent.Future</span><span style="color:#666">[</span><span style="color:#902000">Int</span><span style="color:#666">]</span> <span style="color:#007020;font-weight:bold">=</span> <span style="color:#666">...</span>

<span style="color:#60a0b0;font-style:italic">// Will need at least 20 seconds to complete
</span><span style="color:#60a0b0;font-style:italic"></span>
scala<span style="color:#666">&gt;</span> result<span style="color:#666">.</span>value
res28<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">Option</span><span style="color:#666">[</span><span style="color:#902000">scala.util.Try</span><span style="color:#666">[</span><span style="color:#902000">Int</span><span style="color:#666">]]</span> <span style="color:#007020;font-weight:bold">=</span> <span style="color:#0e84b5;font-weight:bold">Some</span><span style="color:#666">(</span><span style="color:#0e84b5;font-weight:bold">Success</span><span style="color:#666">(</span><span style="color:#40a070">88</span><span style="color:#666">))</span>
</code></pre></div><h3 id="33-future-만들기">3.3 Future 만들기</h3>
<p>Future의 동반 객체에는 이미 완료된 Future를 만들기 위해 successful, failed, fromTry라는 3가지 팩토리 메소드를 제공합니다. 해당 메소드를 사용해서 완료된 퓨처를 만들 때는 ExecutionContext가 필요하지 않습니다.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#666">&gt;</span> <span style="color:#0e84b5;font-weight:bold">Future</span><span style="color:#666">.</span>successful <span style="color:#666">{</span> <span style="color:#40a070">21</span> <span style="color:#666">+</span> <span style="color:#40a070">21</span> <span style="color:#666">}</span>
res2<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">scala.concurrent.Future</span><span style="color:#666">[</span><span style="color:#902000">Int</span><span style="color:#666">]</span> <span style="color:#007020;font-weight:bold">=</span> <span style="color:#666">...</span>

scala<span style="color:#666">&gt;</span> <span style="color:#0e84b5;font-weight:bold">Future</span><span style="color:#666">.</span>failed<span style="color:#666">(</span><span style="color:#007020;font-weight:bold">new</span> <span style="color:#0e84b5;font-weight:bold">Exception</span><span style="color:#666">(</span><span style="color:#4070a0">&#34;bummer!&#34;</span><span style="color:#666">))</span>
res3<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">scala.concurrent.Future</span><span style="color:#666">[</span><span style="color:#902000">Nothing</span><span style="color:#666">]</span> <span style="color:#007020;font-weight:bold">=</span> <span style="color:#666">...</span>

<span style="color:#0e84b5;font-weight:bold">Future</span><span style="color:#666">.</span>fromTry<span style="color:#666">(</span><span style="color:#0e84b5;font-weight:bold">Success</span> <span style="color:#666">{</span> <span style="color:#40a070">21</span> <span style="color:#666">+</span> <span style="color:#40a070">21</span> <span style="color:#666">})</span>
res4<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">scala.concurrent.Future</span><span style="color:#666">[</span><span style="color:#902000">Int</span><span style="color:#666">]</span> <span style="color:#007020;font-weight:bold">=</span> <span style="color:#666">...</span>

<span style="color:#0e84b5;font-weight:bold">Future</span><span style="color:#666">.</span>fromTry<span style="color:#666">(</span><span style="color:#0e84b5;font-weight:bold">Failure</span><span style="color:#666">(</span><span style="color:#007020;font-weight:bold">new</span> <span style="color:#0e84b5;font-weight:bold">Exception</span><span style="color:#666">(</span><span style="color:#4070a0">&#34;bummer!&#34;</span><span style="color:#666">)))</span>
res5<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">scala.concurrent.Future</span><span style="color:#666">[</span><span style="color:#902000">Nothing</span><span style="color:#666">]</span> <span style="color:#007020;font-weight:bold">=</span> <span style="color:#666">...</span>
</code></pre></div><p>또한 Promise를 사용해서 Future를 만들 수 있습니다. 다음 예제를 보겠습니다.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#666">&gt;</span> <span style="color:#007020;font-weight:bold">val</span> pro <span style="color:#007020;font-weight:bold">=</span> <span style="color:#0e84b5;font-weight:bold">Promise</span><span style="color:#666">[</span><span style="color:#902000">Int</span><span style="color:#666">]</span>
pro<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">scala.concurrent.Promise</span><span style="color:#666">[</span><span style="color:#902000">Int</span><span style="color:#666">]</span> <span style="color:#007020;font-weight:bold">=</span> <span style="color:#666">...</span>

scala<span style="color:#666">&gt;</span> <span style="color:#007020;font-weight:bold">val</span> fut <span style="color:#007020;font-weight:bold">=</span> pro<span style="color:#666">.</span>future
fut<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">scala.concurrent.Future</span><span style="color:#666">[</span><span style="color:#902000">Int</span><span style="color:#666">]</span> <span style="color:#007020;font-weight:bold">=</span> <span style="color:#666">...</span>

scala<span style="color:#666">&gt;</span> fut<span style="color:#666">.</span>value
res8<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">Option</span><span style="color:#666">[</span><span style="color:#902000">scala.util.Try</span><span style="color:#666">[</span><span style="color:#902000">Int</span><span style="color:#666">]]</span> <span style="color:#007020;font-weight:bold">=</span> <span style="color:#0e84b5;font-weight:bold">None</span>
</code></pre></div><p>Primise에 success, failure, complete 메소드를 이용해서 Promise를 완료할 수 있습니다.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#666">&gt;</span> pro<span style="color:#666">.</span>success<span style="color:#666">(</span><span style="color:#40a070">42</span><span style="color:#666">)</span>
res9<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">pro.</span><span style="color:#007020;font-weight:bold">type</span> <span style="color:#666">=</span> <span style="color:#666">...</span>

scala<span style="color:#666">&gt;</span> fut<span style="color:#666">.</span>value
res10<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">Option</span><span style="color:#666">[</span><span style="color:#902000">scala.util.Try</span><span style="color:#666">[</span><span style="color:#902000">Int</span><span style="color:#666">]]</span> <span style="color:#007020;font-weight:bold">=</span> <span style="color:#0e84b5;font-weight:bold">Some</span><span style="color:#666">(</span><span style="color:#0e84b5;font-weight:bold">Success</span><span style="color:#666">(</span><span style="color:#40a070">42</span><span style="color:#666">))</span>
</code></pre></div><h3 id="34-future-필터링">3.4 Future 필터링</h3>
<p>filter 메소드는 Future의 결과를 확인하고 결과가 참인 경우 그 값을 그대로 남겨둡니다.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#666">&gt;</span> <span style="color:#007020;font-weight:bold">val</span> fut <span style="color:#007020;font-weight:bold">=</span> <span style="color:#0e84b5;font-weight:bold">Future</span> <span style="color:#666">{</span> <span style="color:#40a070">42</span> <span style="color:#666">}</span>
fut<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">scala.concurrent.Future</span><span style="color:#666">[</span><span style="color:#902000">Int</span><span style="color:#666">]</span> <span style="color:#007020;font-weight:bold">=</span> <span style="color:#666">...</span>

scala<span style="color:#666">&gt;</span> <span style="color:#007020;font-weight:bold">val</span> valid <span style="color:#007020;font-weight:bold">=</span> fut<span style="color:#666">.</span>filter<span style="color:#666">(</span>res <span style="color:#007020;font-weight:bold">=&gt;</span> res <span style="color:#666">&gt;</span> <span style="color:#40a070">0</span><span style="color:#666">)</span>
valid<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">scala.concurrent.Future</span><span style="color:#666">[</span><span style="color:#902000">Int</span><span style="color:#666">]</span> <span style="color:#007020;font-weight:bold">=</span> <span style="color:#666">...</span>

scala<span style="color:#666">&gt;</span> valid<span style="color:#666">.</span>value
res0<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">Option</span><span style="color:#666">[</span><span style="color:#902000">scala.util.Try</span><span style="color:#666">[</span><span style="color:#902000">Int</span><span style="color:#666">]]</span> <span style="color:#007020;font-weight:bold">=</span> <span style="color:#0e84b5;font-weight:bold">Some</span><span style="color:#666">(</span><span style="color:#0e84b5;font-weight:bold">Success</span><span style="color:#666">(</span><span style="color:#40a070">42</span><span style="color:#666">))</span>
</code></pre></div><p>filter 조건을 충족시키는 것이 하나도 없는 경우 <code>NoSucheElementException</code>으로 실패합니다.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#666">&gt;</span> <span style="color:#007020;font-weight:bold">val</span> invalid <span style="color:#007020;font-weight:bold">=</span> fut<span style="color:#666">.</span>filter<span style="color:#666">(</span>res <span style="color:#007020;font-weight:bold">=&gt;</span> res <span style="color:#666">&lt;</span> <span style="color:#40a070">0</span><span style="color:#666">)</span>
invalid<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">scala.concurrent.Future</span><span style="color:#666">[</span><span style="color:#902000">Int</span><span style="color:#666">]</span> <span style="color:#007020;font-weight:bold">=</span> <span style="color:#666">...</span>

scala<span style="color:#666">&gt;</span> invalid<span style="color:#666">.</span>value
res1<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">Option</span><span style="color:#666">[</span><span style="color:#902000">scala.util.Try</span><span style="color:#666">[</span><span style="color:#902000">Int</span><span style="color:#666">]]</span> <span style="color:#007020;font-weight:bold">=</span>
  <span style="color:#0e84b5;font-weight:bold">Some</span><span style="color:#666">(</span><span style="color:#0e84b5;font-weight:bold">Failure</span><span style="color:#666">(</span>java<span style="color:#666">.</span>util<span style="color:#666">.</span><span style="color:#0e84b5;font-weight:bold">NoSuchElementException</span><span style="color:#007020;font-weight:bold">:</span>
  <span style="color:#902000">Future.filter</span> <span style="color:#902000">predicate</span> <span style="color:#902000">is</span> <span style="color:#902000">not</span> <span style="color:#902000">satisfied</span><span style="color:#666">))</span>
</code></pre></div><p>Future에는 withFilter 메소드를 제공하기 때문에 for문에서도 필터로 사용할 수 있습니다.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#666">&gt;</span> <span style="color:#007020;font-weight:bold">val</span> valid <span style="color:#007020;font-weight:bold">=</span> <span style="color:#007020;font-weight:bold">for</span> <span style="color:#666">(</span>res <span style="color:#007020;font-weight:bold">&lt;-</span> fut <span style="color:#007020;font-weight:bold">if</span> res <span style="color:#666">&gt;</span> <span style="color:#40a070">0</span><span style="color:#666">)</span> <span style="color:#007020;font-weight:bold">yield</span> res
valid<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">scala.concurrent.Future</span><span style="color:#666">[</span><span style="color:#902000">Int</span><span style="color:#666">]</span> <span style="color:#007020;font-weight:bold">=</span> <span style="color:#666">...</span>

scala<span style="color:#666">&gt;</span> valid<span style="color:#666">.</span>value
res2<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">Option</span><span style="color:#666">[</span><span style="color:#902000">scala.util.Try</span><span style="color:#666">[</span><span style="color:#902000">Int</span><span style="color:#666">]]</span> <span style="color:#007020;font-weight:bold">=</span> <span style="color:#0e84b5;font-weight:bold">Some</span><span style="color:#666">(</span><span style="color:#0e84b5;font-weight:bold">Success</span><span style="color:#666">(</span><span style="color:#40a070">42</span><span style="color:#666">))</span>
</code></pre></div><p>Future의 collect 메소드를 사용하면 Future 값을 검증하고 변환하는 작업을 한 연산에서 수행할 수 있습니다. collect에 전달되는 부분 함수를 가지고 변환을 해서 처리할 수 있습니다.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#666">&gt;</span> <span style="color:#007020;font-weight:bold">val</span> valid <span style="color:#007020;font-weight:bold">=</span> fut collect <span style="color:#666">{</span> <span style="color:#007020;font-weight:bold">case</span> res <span style="color:#007020;font-weight:bold">if</span> res <span style="color:#666">&gt;</span> <span style="color:#40a070">0</span> <span style="color:#007020;font-weight:bold">=&gt;</span> res <span style="color:#666">+</span> <span style="color:#40a070">46</span> <span style="color:#666">}</span>
valid<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">scala.concurrent.Future</span><span style="color:#666">[</span><span style="color:#902000">Int</span><span style="color:#666">]</span> <span style="color:#007020;font-weight:bold">=</span> <span style="color:#666">...</span>

scala<span style="color:#666">&gt;</span> valid<span style="color:#666">.</span>value
res17<span style="color:#007020;font-weight:bold">:</span> <span style="color:#902000">Option</span><span style="color:#666">[</span><span style="color:#902000">scala.util.Try</span><span style="color:#666">[</span><span style="color:#902000">Int</span><span style="color:#666">]]</span> <span style="color:#007020;font-weight:bold">=</span> <span style="color:#0e84b5;font-weight:bold">Some</span><span style="color:#666">(</span><span style="color:#0e84b5;font-weight:bold">Success</span><span style="color:#666">(</span><span style="color:#40a070">88</span><span style="color:#666">))</span>
</code></pre></div><p>이번 포스트에서는 스칼라에서 제공하는 동시성 도구인 Future에 관해서 살펴보았습니다. 스칼라의 Future를 사용하면 비동기적 프로그래밍이 가능합니다. Future의 사용법의 내용이 길어 다음 포스트에 이어서 작성할 예정입니다.</p>
<h2 id="reference">Reference</h2>
<ul>
<li><a href="https://www.aladin.co.kr/shop/wproduct.aspx?ISBN=8960777730&amp;start=pnaver_02">Programming in Scala</a></li>
<li><a href="https://partnerjun.tistory.com/26">Java의 CompletableFuture, Scala의 Future와 Promise</a></li>
</ul>

        </p>

        <br />
        <br />

        <div class="paging post-paging" style="margin-bottom: 15px;">
            
            
            
            <div style="text-align: right">
                <a class="right" href="https://eoriented.github.io/post/scala-future-and-concurrency-2/" rel="next" style="color: #64BEA3">
                    <span>스칼라 퓨처(Future)와 동시성(Concurrency) - 2</span>&nbsp;&nbsp;<i class="fa fa-play" aria-hidden="true"></i>
                </a>
            </div>
            
            
        </div>
    </div>

    
    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "smart-tiger" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    

    <div class="page-footer">
        
        <hr class="footer-divider">
        
            <a class="tag" href="https://eoriented.github.io/tags/future">#Future</a>
        
            <a class="tag" href="https://eoriented.github.io/tags/%EB%8F%99%EC%8B%9C%EC%84%B1">#동시성</a>
        
            <a class="tag" href="https://eoriented.github.io/tags/%EB%B9%84%EB%8F%99%EA%B8%B0">#비동기</a>
        
            <a class="tag" href="https://eoriented.github.io/tags/%EB%B9%84%EB%8F%99%EA%B8%B0%EC%B2%98%EB%A6%AC">#비동기처리</a>
        
            <a class="tag" href="https://eoriented.github.io/tags/thread">#thread</a>
        
      
    </div>


        
        </div>
        <footer class="footer-mobile">
	<div class="social-icons" style="text-align: center">
    
    <a class="social-icon" href="https://github.com/eoriented" target="_blank" rel="noopener" title="GitHub">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M13.9988029,1.32087331 C6.82105037,1.32087331 1,7.14112562 1,14.3212723 C1,20.0649109 4.72454649,24.9370678 9.89038951,26.6560892 C10.5408085,26.7757983 10.7778323,26.374374 10.7778323,26.0296121 C10.7778323,25.7215609 10.7666595,24.9035493 10.760275,23.8189856 C7.14426471,24.6042767 6.38131925,22.0760223 6.38131925,22.0760223 C5.78995672,20.5740732 4.93762853,20.1742451 4.93762853,20.1742451 C3.75729765,19.3682044 5.02701126,19.3841656 5.02701126,19.3841656 C6.33183953,19.4759425 7.01817121,20.7241085 7.01817121,20.7241085 C8.17775254,22.7104801 10.0611744,22.1366749 10.8017741,21.8038838 C10.919887,20.9643246 11.2558703,20.3913175 11.6269683,20.066507 C8.74038491,19.7385043 5.70536235,18.6228163 5.70536235,13.6413251 C5.70536235,12.2223743 6.21213051,11.0611968 7.04370914,10.1530044 C6.90963504,9.82420367 6.46351945,8.50181809 7.17139875,6.71256734 C7.17139875,6.71256734 8.26234691,6.36301702 10.7459099,8.04532771 C11.78259,7.75642995 12.8950858,7.61277914 14.000399,7.60719272 C15.1049142,7.61277914 16.2166119,7.75642995 17.2548881,8.04532771 C19.736855,6.36301702 20.8262071,6.71256734 20.8262071,6.71256734 C21.5356825,8.50181809 21.0895669,9.82420367 20.9562909,10.1530044 C21.7894656,11.0611968 22.2922435,12.2223743 22.2922435,13.6413251 C22.2922435,18.6355852 19.2524325,19.734514 16.3570705,20.0561322 C16.8231376,20.4575564 17.2389269,21.2508282 17.2389269,22.4638795 C17.2389269,24.2012564 17.2229657,25.603448 17.2229657,26.0296121 C17.2229657,26.3775663 17.4575954,26.7821827 18.116793,26.6552912 C23.2786458,24.9322794 27,20.0633148 27,14.3212723 C27,7.14112562 21.1789496,1.32087331 13.9988029,1.32087331"></path>
        </svg>
    </a>
    

    

    
    <a class="social-icon" href="mailto:eoriented@gmail.com" target="_blank" rel="noopener" title="Email">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M25.2794292,5.59128519 L14,16.8707144 L2.72057081,5.59128519 C3.06733103,5.30237414 3.51336915,5.12857603 4,5.12857603 L24,5.12857603 C24.4866308,5.12857603 24.932669,5.30237414 25.2794292,5.59128519 Z M25.9956978,6.99633695 C25.998551,7.04004843 26,7.08414302 26,7.12857603 L26,20.871424 C26,21.0798433 25.9681197,21.2808166 25.9089697,21.4697335 L18.7156355,14.2763993 L25.9956978,6.99633695 Z M24.9498374,22.6319215 C24.6672737,22.7846939 24.3437653,22.871424 24,22.871424 L4,22.871424 C3.5268522,22.871424 3.09207889,22.7071233 2.74962118,22.432463 L10.0950247,15.0870594 L13.9848068,18.9768415 L14.1878486,18.7737996 L14.2030419,18.7889929 L17.6549753,15.3370594 L24.9498374,22.6319215 Z M2.00810114,21.0526627 C2.00273908,20.9929669 2,20.9325153 2,20.871424 L2,7.12857603 C2,7.08414302 2.00144896,7.04004843 2.00430222,6.99633695 L9.03436454,14.0263993 L2.00810114,21.0526627 Z"></path>
        </svg>
    </a>
    

    
    <a class="social-icon" href="https://eoriented.github.io/index.xml" target="_blank" rel="noopener" type="application/rss+xml" title="Rss">
        <svg width="28px" height="28px" viewBox="0 0 8 8" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <circle xmlns="http://www.w3.org/2000/svg" class="symbol" cx="2" cy="6" r="1"/>
            <path xmlns="http://www.w3.org/2000/svg" class="symbol" d="m 1,4 a 3,3 0 0 1 3,3 h 1 a 4,4 0 0 0 -4,-4 z"/>
            <path xmlns="http://www.w3.org/2000/svg" class="symbol" d="m 1,2 a 5,5 0 0 1 5,5 h 1 a 6,6 0 0 0 -6,-6 z"/>
        </svg>
    </a>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    
    

    
</div>




	
		
		
		
	

	<script src="https://eoriented.github.io/js/main.min.fa5c2b23e07b5d9bfad267a52b4b24fdb053e6fb7524993383594926a3ac270c.js" integrity="sha256-+lwrI+B7XZv60melK0sk/bBT5vt1JJkzg1lJJqOsJww="></script>
</footer>
    </body>
</html>