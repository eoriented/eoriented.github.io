<!DOCTYPE html>

<html lang="ko-KR">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="format-detection" content="telephone=no"/>

    <title>Smart Tiger&#39;s blog</title>
    
    <link rel="apple-touch-icon" sizes="180x180" href="https://eoriented.github.io/apple-touch-icon.png">
    
    
    <link rel="icon" type="image/png" sizes="16x16" href="https://eoriented.github.io/favicon.ico">
    <link rel="manifest" href="https://eoriented.github.io/manifest.json">
    <link rel="mask-icon" href="https://eoriented.github.io/safari-pinned-tab.svg" color="#FF3DB4">
    <meta name="theme-color" content="#ffffff">

    
    
    
    <link rel="stylesheet" href="https://eoriented.github.io/css/main.min.dd568c6dd83d023b8b55f4ca7cf388dc6ce3b3ae5a182c7532b74b8b9570e4ca.css"/>

    
    
    

    
    
 
    
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-160052384-1', 'auto');
	
	ga('send', 'pageview');
}
</script>


    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
  });
  MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script> 
</head>
    <body>
        
<nav>
  <header>
    <div class="site-title">
        
        <a href="https://eoriented.github.io/">
        <img style="display: block; margin: 0px auto" width="90%" src="https://eoriented.github.io/images/logo2.png" /></a>
    </div>  
</header>
  <div class="nav-menu">
  
    <a class="color-link nav-link" href="https://eoriented.github.io/categories/bigdata/">Big data</a>
  
    <a class="color-link nav-link" href="https://eoriented.github.io/categories/machine-learning/">Machine learning</a>
  
    <a class="color-link nav-link" href="https://eoriented.github.io/categories/programming/">Programming</a>
  
    <a class="color-link nav-link" href="https://eoriented.github.io/categories/cloud/">Cloud</a>
  
    <a class="color-link nav-link" href="https://eoriented.github.io/categories/tools/">Tools</a>
  
    <a class="color-link nav-link" href="https://eoriented.github.io/categories/">Categories</a>
  
    <a class="color-link nav-link" href="https://eoriented.github.io/tags/">Tags</a>
  
  
</div>
<footer class="footer">
	<div class="social-icons" style="text-align: center">
    
    <a class="social-icon" href="https://github.com/eoriented" target="_blank" rel="noopener" title="GitHub">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M13.9988029,1.32087331 C6.82105037,1.32087331 1,7.14112562 1,14.3212723 C1,20.0649109 4.72454649,24.9370678 9.89038951,26.6560892 C10.5408085,26.7757983 10.7778323,26.374374 10.7778323,26.0296121 C10.7778323,25.7215609 10.7666595,24.9035493 10.760275,23.8189856 C7.14426471,24.6042767 6.38131925,22.0760223 6.38131925,22.0760223 C5.78995672,20.5740732 4.93762853,20.1742451 4.93762853,20.1742451 C3.75729765,19.3682044 5.02701126,19.3841656 5.02701126,19.3841656 C6.33183953,19.4759425 7.01817121,20.7241085 7.01817121,20.7241085 C8.17775254,22.7104801 10.0611744,22.1366749 10.8017741,21.8038838 C10.919887,20.9643246 11.2558703,20.3913175 11.6269683,20.066507 C8.74038491,19.7385043 5.70536235,18.6228163 5.70536235,13.6413251 C5.70536235,12.2223743 6.21213051,11.0611968 7.04370914,10.1530044 C6.90963504,9.82420367 6.46351945,8.50181809 7.17139875,6.71256734 C7.17139875,6.71256734 8.26234691,6.36301702 10.7459099,8.04532771 C11.78259,7.75642995 12.8950858,7.61277914 14.000399,7.60719272 C15.1049142,7.61277914 16.2166119,7.75642995 17.2548881,8.04532771 C19.736855,6.36301702 20.8262071,6.71256734 20.8262071,6.71256734 C21.5356825,8.50181809 21.0895669,9.82420367 20.9562909,10.1530044 C21.7894656,11.0611968 22.2922435,12.2223743 22.2922435,13.6413251 C22.2922435,18.6355852 19.2524325,19.734514 16.3570705,20.0561322 C16.8231376,20.4575564 17.2389269,21.2508282 17.2389269,22.4638795 C17.2389269,24.2012564 17.2229657,25.603448 17.2229657,26.0296121 C17.2229657,26.3775663 17.4575954,26.7821827 18.116793,26.6552912 C23.2786458,24.9322794 27,20.0633148 27,14.3212723 C27,7.14112562 21.1789496,1.32087331 13.9988029,1.32087331"></path>
        </svg>
    </a>
    

    

    
    <a class="social-icon" href="mailto:eoriented@gmail.com" target="_blank" rel="noopener" title="Email">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M25.2794292,5.59128519 L14,16.8707144 L2.72057081,5.59128519 C3.06733103,5.30237414 3.51336915,5.12857603 4,5.12857603 L24,5.12857603 C24.4866308,5.12857603 24.932669,5.30237414 25.2794292,5.59128519 Z M25.9956978,6.99633695 C25.998551,7.04004843 26,7.08414302 26,7.12857603 L26,20.871424 C26,21.0798433 25.9681197,21.2808166 25.9089697,21.4697335 L18.7156355,14.2763993 L25.9956978,6.99633695 Z M24.9498374,22.6319215 C24.6672737,22.7846939 24.3437653,22.871424 24,22.871424 L4,22.871424 C3.5268522,22.871424 3.09207889,22.7071233 2.74962118,22.432463 L10.0950247,15.0870594 L13.9848068,18.9768415 L14.1878486,18.7737996 L14.2030419,18.7889929 L17.6549753,15.3370594 L24.9498374,22.6319215 Z M2.00810114,21.0526627 C2.00273908,20.9929669 2,20.9325153 2,20.871424 L2,7.12857603 C2,7.08414302 2.00144896,7.04004843 2.00430222,6.99633695 L9.03436454,14.0263993 L2.00810114,21.0526627 Z"></path>
        </svg>
    </a>
    

    
    <a class="social-icon" href="https://eoriented.github.io/index.xml" target="_blank" rel="noopener" type="application/rss+xml" title="Rss">
        <svg width="28px" height="28px" viewBox="0 0 8 8" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <circle xmlns="http://www.w3.org/2000/svg" class="symbol" cx="2" cy="6" r="1"/>
            <path xmlns="http://www.w3.org/2000/svg" class="symbol" d="m 1,4 a 3,3 0 0 1 3,3 h 1 a 4,4 0 0 0 -4,-4 z"/>
            <path xmlns="http://www.w3.org/2000/svg" class="symbol" d="m 1,2 a 5,5 0 0 1 5,5 h 1 a 6,6 0 0 0 -6,-6 z"/>
        </svg>
    </a>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    
    

    
</div>




	
	

	<script src="https://eoriented.github.io/js/main.min.fa5c2b23e07b5d9bfad267a52b4b24fdb053e6fb7524993383594926a3ac270c.js" integrity="sha256-+lwrI+B7XZv60melK0sk/bBT5vt1JJkzg1lJJqOsJww="></script>
</footer>
</nav>
        <div id="content" class="content-container">
        
<h1 class="post-title">스트림 프로세싱(Stream Processing) - 1</h1>
    
    <div>
        <p>
        <p>일반적으로 배치 처리의 문제점은 입력의 변화가 특정 기간이 끝나야 반영이 되는 문제가 있습니다. 이러한 지연(Lag)을 줄이려면 더 자주 실행할 수 있도록 해야 합니다. 고정된 타임 슬라이스 별로 처리하는 것이 아닌 이벤트가 발생할 때마다 처리하도록 하는 것입니다. 이것이 바로 스트림 처리입니다. 첫번째 그림은 배치 처리의 시간 지연을 나타내는 그림입니다. 배치 처리의 경우 예를 들어 입력 데이터가 하루 단위로 생성된다고 할 때 처리하고 반영되는데 하루의 지연이 발생합니다.</p>
<figure >

  <img src="https://eoriented.github.io/images/stream-processing/batch-time-lag.png" alt="batch processing" width="100%"  style="max-width: 700px" />
  

<figcaption>
  <p>
    batch processing
    
    
    
  </p> 
</figcaption>

</figure>
<p>아래의 그림은 스트림 처리의 지연 시간을 나타내는 그립니다. 스트림 처리의 경우 바로 처리가 가능하기 때문에 시간 지연이 거의 발생하지 않는 것을 확인할 수 있습니다.</p>
<figure >

  <img src="https://eoriented.github.io/images/stream-processing/stream-time-lag.png" alt="stream processing" width="100%"  style="max-width: 700px" />
  

<figcaption>
  <p>
    stream processing
    
    
    
  </p> 
</figcaption>

</figure>
<p>일반적으로 스트림은 시간 흐름에 따라 점진적으로 생산되는 데이터를 말합니다. 여기서는 데이터 관리 메커니즘으로 이벤트 스트림에 대해 살펴볼 예정입니다.</p>
<h2 id="이벤트-스트림-전송">이벤트 스트림 전송</h2>
<p>간단히 스트림 처리에서 사용하는 용어들에 대해 살펴보겠습니다. 배치 처리와 비교하면 조금더 손쉽게 이해할 수 있습니다. 배치의 입력은 레코드의 집합인 <strong>파일</strong>입니다. 스트림 처리의 입력은 하나의 <strong>이벤트</strong> 혹은 레코드라고 할 수 있습니다. 이벤트의 경우 이벤트가 발생한 시간 정보를 포함하고 있습니다. 이벤트의 예로는 웹 페이지를 보거나 상품을 구매하는 일과 같이 사용자가 취한 행동 등이 될 수 있습니다.</p>
<p>스트림 처리의 이벤트는 한정되지 않고 계속 처리되는 데이터 입니다. 그렇기 때문에 스트림 처리에서는 이벤트를 생산하는 생산자(혹은 발행자나 전송자라고도 합니다)가 존재합니다. 그리고 이렇게 발생한 이벤트를 가져가서 처리하는 소비자(구독자 또는 수신자)가 존재합니다. 이 이벤트는 한 소비자가 아닌 여러 소비자가 소비할 수 있습니다. 또한 파일 시스템에서 관련 레코드 집합을 파일 이름으로 구분하는 것 같이 스트림 시스템에서는 관련 이벤트들을 토픽으로 구분합니다.</p>
<p>그럼 간단한 스트림 시스템을 만들기 위해선 어떻게 하면 될까요? 생산자와 소비자를 연결해주는 역할을 하는 것이 필요합니다. 파일이나 데이터베이스가 그러한 역할을 하기에 충분합니다. 생산자는 이벤트를 데이터베이스에 기록하고 소비자가 이를 주기적으로 폴링해서 데이터를 가져가서 처리하면 될 것입니다. 그러나 기존의 데이터베이스가 스트림 목적으로 설계하지 않았다면 데이터베이스로부터 폴링을 위한 비용이 굉장히 클 것입니다. 그래서 폴링보다는 새로운 이벤트가 발생할 때마다 소비자에게 알려주는 것이 더 나을 것입니다. 이와 같이 새로운 이벤트가 발생하면 소비자에게 알려주기 위해 사용하는 것이 메시징 시스템입니다.</p>
<h3 id="메시징-시스템">메시징 시스템</h3>
<p>메시징 시스템을 구축하는 간단한 방법은 생산자와 소비자 사이에 TCP 연결과 같은 직접 통신 채널을 연결하는 방법입니다. TCP 연결은 전송자와 수신자가 일대일로 연결됩니다. 그러나 메시징 시스템은 다음 그림과 같이 다수의 생산자가 같은 토픽으로 메시지를 전송할 수 있고 다수의 소비자가 하나의 토픽에서 메시지를 받아갈 수 있습니다.</p>
<figure >
<a href="http://gsraj.tripod.com/jms/jms.html" target="_blank">
  <img src="https://eoriented.github.io/images/stream-processing/messaging-system.gif" width="100%"  style="max-width: 550px" />
  </a>

</figure>
<p>이러한 메시징 시스템은 pub/sub 모델을 사용합니다. 이러한 pub/sub 모델에서는 다음의 조건들에 따라 다양하게 설계되었습니다.</p>
<ul>
<li>생산자가 소비자가 메시지를 처리하는 속도보다 빠르게 메시지를 전송하는 경우에 대한 처리
<ul>
<li>메시지를 버린다.</li>
<li>큐에 메시지를 버퍼링한다.</li>
<li>배압(backpressure, 흐름 제어(flow control)라고도 하며, 생산자가 메시지를 더 보내지 못하게 막는 것입니다)을 적용한다.</li>
</ul>
</li>
<li>장애 발생시 대처 방법
<ul>
<li>메세지가 손실에 대한 처리</li>
</ul>
</li>
</ul>
<p>아래의 그림은 배압을 적용했을 때를 나타내는 그림입니다.</p>
<figure >
<a href="http://eyeahs.github.io/blog/2017/01/24/a-journey-into-reactive-streams/" target="_blank">
  <img src="https://eoriented.github.io/images/stream-processing/backpressure.png" width="100%"  style="max-width: 450px" />
  </a>

</figure>
<p>이와 같이 애플리케이션에서 메시지 손실을 허용할지 말지 여부에 따라 어떤 메시지 시스템을 적용할지 다릅니다. 그러므로 다양한 애플리케이션의 요구사항에 부합할 수 있는 메시징 시스템을 적용해야 합니다. 그러면 메시징 시스템은 어떻게 구성할 수 있는지 살펴보도록 하겠습니다.</p>
<h4 id="생산자에서-소비자로-직접-메시지-전달하기">생산자에서 소비자로 직접 메시지 전달하기</h4>
<p>다양한 메시지 시스템은 중간에 따로 노드를 통하지 않고 직접 생산자와 소비자가 네트워크로 연결되서 통신합니다. 이렇게 직접 생산자와 소비자가 연결되서 처리하는 경우에는 일반적으로 메시지가 유실될 가능성을 염두해야 합니다.</p>
<h4 id="메시지-브로커">메시지 브로커</h4>
<p>메시지 브로커는 생산자와 소비자 사이에 있는 중간 노드의 역할을 합니다. 메시지 브로커는 스트림 처리하는데 최적화 된 데이터베이스의 일종이라고 생각하면 됩니다. 생산자는 메시지 브로커로 메시지를 전송하고 소비자는 브로커로부터 메시지를 읽어서 처리할 수 있습니다. 생산자와 소비자는 메시지 브로커에 클라이언트로 접속해서 처리하면됩니다.</p>
<p>메시지 브로커의 경우 위의 직접 네트워크로 연결되서 통신하는 방식과 다르게 클라이언트의 상태 변경(예를 들어 접속, 접속 해제, 장애)에 잘 대처할 수 있습니다. 예를 들어 소비자가 네트워크 장애가 발생해서 잠시 끊겼다가 다시 연결됐을 때도 메시지가 유실되는 것을 걱정하지 않아도 됩니다. 그외 다양한 장점들이 존재합니다.</p>
<h4 id="메시지-브로커와-데이터베이스-비교">메시지 브로커와 데이터베이스 비교</h4>
<p>앞서 메시지 브로커는 스트림 처리를 위한 데이터베이스의 일종이라고 하였습니다. 그러면 일반적인 데이터베이스와 메시지 브로커를 비교하여 살펴보겠습니다.</p>


  

  



<table  align="center" style="max-width:1100px">
<thead>
<tr>
<th></th>
<th>메시지 브로커</th>
<th>데이터베이스</th>
</tr>
</thead>
<tbody>
<tr>
<td>데이터 보관 기간</td>
<td>대부분 일시적</td>
<td>영구적</td>
</tr>
<tr>
<td>데이터 검색</td>
<td>특정 패턴과 일치하는 토픽의 부분 집합 구독 형식</td>
<td>보조 색인 등의 다양한 검색 방법 지원</td>
</tr>
<tr>
<td>데이터 변화 알림</td>
<td>데이터가 변하면 알려줌</td>
<td>알려주지 않음</td>
</tr>
</tbody>
</table>
<h4 id="여러multiple-소비자">여러(Multiple) 소비자</h4>
<p>여러 사용자가 하나의 토픽에서 메시지를 읽을 때 사용하는 패턴은 2가지가 있습니다. 다음 그림과 같이 로드 밸런싱과 팬 아웃 패턴입니다. 로드 밸런싱은 메시자가 여러 소비자 중 하나에 전달이 되는 것이고 팬 아웃은 메시지가 모든 소비자에게 전달되는 것입니다.</p>
<figure >
<a href="https://www.codebycase.com/bigdata/data-intensive-applications" target="_blank">
  <img src="https://eoriented.github.io/images/stream-processing/load-balancing-and-fan-out.png" width="100%"  style="max-width: 700px" />
  </a>

</figure>
<p>또한 두 패턴은 함께 사용 가능합니다. 예를 들어 두 소비자 그룹에서 하나의 토픽을 구독하여 각 그룹들은 해당 토픽의 모든 메시지를 받습니다. 그러나 그룹 내에서는 각 메시지를 하나의 노드에게만 전달하게 하는 것입니다.</p>
<h4 id="확인-응답acknowledgments과-재전송redelivery">확인 응답(Acknowledgments)과 재전송(Redelivery)</h4>
<p>앞서 설명한대로 브로커를 통해 장애에 대처할 수 있다고 하였습니다. 브로커에서 소비자에게 메시지를 전달하였지만 소비자에서 장애가 발생하여 처리를 못한 경우가 발생할 수 있습니다. 메시지 브로커는 이러한 문제를 Ack를 통해 해결합니다. 그래서 소비자는 메시지가 정상적으로 받아서 처리했으면 브로커에게 명시적으로 알려줘야 합니다.</p>
<p>이전에 설명한 여러 소비자가 로드 밸런싱을 통해 메시지를 처리하는 경우 장애가 발생했을 때 메시지 순서가 바뀔 수도 있습니다. 다음 그림에서 처럼 두 소비자 중 소비자 2가 장애가 발생했을 때 Ack를 브로커에게 전달하지 않기 때문에 브로커는 다시 소비자 1에게 메시지를 재전송하게 됩니다. 이 경우 메시지의 순서가 뒤바뀔 수도 있습니다. 메시지의 순서가 상관 없는 경우에는 상관 없으나 메시지 순서가 중요한 경우에는 소비자마다 독립된 큐를 사용해야 합니다.</p>
<figure >

  <img src="https://eoriented.github.io/images/stream-processing/message-order-problem.png" width="100%"  style="max-width: 700px" />
  

</figure>
<h3 id="로그-기반-메시지-브로커">로그 기반 메시지 브로커</h3>
<p>브로커는 메시지를 일시적으로 보관하는 개념으로 만들어졌습니다. 그렇기 때문에 일반적인 메시지 브로커의 경우 메시지를 디스크에 지속성 있게 기록하더라도 메시지가 소비자에게 전달된 후에는 삭제를 합니다. 데이터베이스와 파일 시스템은 이와는 반대의 접근법을 사용합니다. 즉, 누군가 명시적으로 데이터를 삭제할 때까지 영구 보관을 하는 것입니다. 그럼 메시지 시스템에서 데이터를 영구 보관이 가능하면 어떤 것이 좋을까요? 예를 들어 브로커가 소비자가 메시지를 처리했다라는 Ack가 와서 데이터를 삭제하는 경우 메시지 복구가 불가능합니다. 그래서 소비자는 처리를 다시 실행하도 동일한 결과를 받지 못합니다. 그러나 영구 저장을 하면 입력의 변경이 없이 반복 수행이 가능해지고, 재실행하면 동일 결과를 받을 수 있습니다. 이와 같은 효과는 많은 장점을 제공합니다.
이와 같이 데이터베이스의 지속적인 저장 방식과 메시지 시스템의 알림 기능을 조합한 것이 로그 기반 메시지 브로커(log-based message broker)입니다.</p>
<h4 id="메시지-저장소를-위한-로그-사용">메시지 저장소를 위한 로그 사용</h4>
<p>로그 기반 브로커의 경우 생산자가 보낸 메시지는 로그 끝에 추가 하고 소비자는 로그를 순차적으로 읽어 메시지를 받는 형식으로 구현합니다. 보통 하나의 디스크를 쓰는 것보다 여러 디스크를 사용하여 로그를 파티셔닝해서 처리량을 높이도록 구현합니다.</p>
<figure >
<a href="https://www.codebycase.com/bigdata/data-intensive-applications" target="_blank">
  <img src="https://eoriented.github.io/images/stream-processing/topic-partition.png" width="100%"  style="max-width: 700px" />
  </a>

</figure>
<p>위의 그림과 같이 파티션 내의 브로커는 메시지의 오프셋을 부여합니다. 그리고 소비자는 파티션 별로 오프셋 정보를 가지고 있어서 자신이 얼만큼 읽었는지를 알고 있습니다.<br>
이와 깉이 로그 기반 메시지 브로커의 대표적인 예가 아파치 카프카, 아마존 키네시스 스트림, 트위터의 DistributedLog 등이 있습니다.</p>
<h4 id="로그-방식과-전통적-메시징-방식-비교">로그 방식과 전통적 메시징 방식 비교</h4>
<p>전통적인 메시징 방식의 대표적인 것이 JMS/AMQP 방식이 있습니다. 보통 메시지의 순서가 중요하지 않고, 메시지를 처리하는 비용이 비싸고 메시지 단위로 병렬화 처리하고 싶은 경우 이러한 메시징 방식을 사용합니다. 그러나 처리량이 많고 메시지를 처리하는 비용은 싸지만(처리하는 속도는 빠르지만) 메시지의 순서가 중요한 경우에는 로그 기반의 메시지 브로커가 적합합니다.</p>
<h4 id="소비자가-생산자를-따라갈-수-없을-때">소비자가 생산자를 따라갈 수 없을 때</h4>
<p>위에서 설명한대로 소비자의 메시지 처리량이 생산자를 따라갈 수 없을 때는 3가지 선택지가 있다고 했습니다.</p>
<ul>
<li>메시지 버리기</li>
<li>버퍼링</li>
<li>배압 적용</li>
</ul>
<p>로그 기반의 메시지 브로커의 경우 버퍼링 형태라고 할 수 있습니다. 물론 소비자가 보유할 수 있는 메시지 버퍼의 크기보다 더 뒤처져 있는 경우에는 메시지를 읽을 수 없는 경우도 있습니다. 그러나 보통 소비자와 생산자가 얼마나 차이나는지 모니터링을 통해 문제를 고쳐서 따라 잡을 수 있는 시간은 충분히 벌 수 있습니다.</p>
<p>만약 소비자 처리 속도가 느려 메시지가 생산되는 속도를 따라 잡지 못하다가 너무 뒤쳐지게 된 경우 소비자 오프셋이 이미 삭제된 메시지를 가리킬 수 있습니다. 로그 기반 메시지 브로커는 보통 크기가 제한된 버퍼의 형태로 구현합니다. 그래서 버퍼가 가득 차게 되면 오래된 메시지부터 삭제를 하게 됩니다. 이러한 크기가 제한된 버퍼는 원형 버퍼의 형태로 구현합니다.</p>
<h4 id="지난-메시지-재처리">지난 메시지 재처리</h4>
<p>AMQP와 JMS 유형의 메시지 브로커는 Ack를 받은 메시지는 삭제한다고 하였습니다. 그에 반해 로그 기반 메시지 브로커는 메시지나 로그를 삭제하지 않고 오프셋만 변경합니다. 이 오프셋은 소비자가 관리하기 때문에 원한다면 오프셋을 조절하여 어제 처리한 메시지를 재처리하는 등의 지난 메시지를 다시 처리할 수 있습니다.</p>
<h2 id="정리">정리</h2>
<p>이번 포스트에서는 이벤트 스트림에 대해 알아보았습니다. 스트림 처리는 고정 크기의 입력이 아닌 끝이 없는 스트림 상에서 연속적으로 처리되는 것입니다. 이러한 스트림은 주로 메시지 브로커를 사용하여 처리합니다. 이번 포스트에서는 메시지 브로커를 2가지 관점에서 살펴보았습니다. 하나는 전통적인 메시지 브로커(AMQP/JMS 스타일)와 다른 하나는 로그 기반 메시지 브로커입니다.</p>
<p>다음 포스트에서는 이어서 이벤트 스트림의 아이디어를 데이터베이스와 연관시켜 살펴보도록 하겠습니다.</p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://wikibook.co.kr/data-intensive-applications/">데이터 중심 애플리케이션 설계</a></li>
<li><a href="https://www.codebycase.com/bigdata/data-intensive-applications#c11-stream-processing">https://www.codebycase.com/bigdata/data-intensive-applications#c11-stream-processing</a></li>
</ul>

        </p>

        <br />
        <br />

        <div class="paging post-paging" style="margin-bottom: 15px;">
            
            
            
            <div style="text-align: right">
                <a class="right" href="https://eoriented.github.io/post/stream-processing-2/" rel="next" style="color: #64BEA3">
                    <span>스트림 프로세싱(Stream Processing) - 2</span>&nbsp;&nbsp;<i class="fa fa-play" aria-hidden="true"></i>
                </a>
            </div>
            
            
        </div>
    </div>

    
    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "smart-tiger" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    

    <div class="page-footer">
        
        <hr class="footer-divider">
        
            <a class="tag" href="https://eoriented.github.io/tags/stream">#stream</a>
        
            <a class="tag" href="https://eoriented.github.io/tags/stream-processor">#stream processor</a>
        
            <a class="tag" href="https://eoriented.github.io/tags/messaging-system">#messaging system</a>
        
            <a class="tag" href="https://eoriented.github.io/tags/message">#message</a>
        
            <a class="tag" href="https://eoriented.github.io/tags/broker">#broker</a>
        
            <a class="tag" href="https://eoriented.github.io/tags/batch">#batch</a>
        
            <a class="tag" href="https://eoriented.github.io/tags/desiging-data-intensive-application">#desiging data-intensive application</a>
        
            <a class="tag" href="https://eoriented.github.io/tags/ddia">#ddia</a>
        
            <a class="tag" href="https://eoriented.github.io/tags/%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%A4%91%EC%8B%AC-%EC%95%A0%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98-%EC%84%A4%EA%B3%84">#데이터 중심 애플리케이션 설계</a>
        
      
    </div>


        
        </div>
        <footer class="footer-mobile">
	<div class="social-icons" style="text-align: center">
    
    <a class="social-icon" href="https://github.com/eoriented" target="_blank" rel="noopener" title="GitHub">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M13.9988029,1.32087331 C6.82105037,1.32087331 1,7.14112562 1,14.3212723 C1,20.0649109 4.72454649,24.9370678 9.89038951,26.6560892 C10.5408085,26.7757983 10.7778323,26.374374 10.7778323,26.0296121 C10.7778323,25.7215609 10.7666595,24.9035493 10.760275,23.8189856 C7.14426471,24.6042767 6.38131925,22.0760223 6.38131925,22.0760223 C5.78995672,20.5740732 4.93762853,20.1742451 4.93762853,20.1742451 C3.75729765,19.3682044 5.02701126,19.3841656 5.02701126,19.3841656 C6.33183953,19.4759425 7.01817121,20.7241085 7.01817121,20.7241085 C8.17775254,22.7104801 10.0611744,22.1366749 10.8017741,21.8038838 C10.919887,20.9643246 11.2558703,20.3913175 11.6269683,20.066507 C8.74038491,19.7385043 5.70536235,18.6228163 5.70536235,13.6413251 C5.70536235,12.2223743 6.21213051,11.0611968 7.04370914,10.1530044 C6.90963504,9.82420367 6.46351945,8.50181809 7.17139875,6.71256734 C7.17139875,6.71256734 8.26234691,6.36301702 10.7459099,8.04532771 C11.78259,7.75642995 12.8950858,7.61277914 14.000399,7.60719272 C15.1049142,7.61277914 16.2166119,7.75642995 17.2548881,8.04532771 C19.736855,6.36301702 20.8262071,6.71256734 20.8262071,6.71256734 C21.5356825,8.50181809 21.0895669,9.82420367 20.9562909,10.1530044 C21.7894656,11.0611968 22.2922435,12.2223743 22.2922435,13.6413251 C22.2922435,18.6355852 19.2524325,19.734514 16.3570705,20.0561322 C16.8231376,20.4575564 17.2389269,21.2508282 17.2389269,22.4638795 C17.2389269,24.2012564 17.2229657,25.603448 17.2229657,26.0296121 C17.2229657,26.3775663 17.4575954,26.7821827 18.116793,26.6552912 C23.2786458,24.9322794 27,20.0633148 27,14.3212723 C27,7.14112562 21.1789496,1.32087331 13.9988029,1.32087331"></path>
        </svg>
    </a>
    

    

    
    <a class="social-icon" href="mailto:eoriented@gmail.com" target="_blank" rel="noopener" title="Email">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M25.2794292,5.59128519 L14,16.8707144 L2.72057081,5.59128519 C3.06733103,5.30237414 3.51336915,5.12857603 4,5.12857603 L24,5.12857603 C24.4866308,5.12857603 24.932669,5.30237414 25.2794292,5.59128519 Z M25.9956978,6.99633695 C25.998551,7.04004843 26,7.08414302 26,7.12857603 L26,20.871424 C26,21.0798433 25.9681197,21.2808166 25.9089697,21.4697335 L18.7156355,14.2763993 L25.9956978,6.99633695 Z M24.9498374,22.6319215 C24.6672737,22.7846939 24.3437653,22.871424 24,22.871424 L4,22.871424 C3.5268522,22.871424 3.09207889,22.7071233 2.74962118,22.432463 L10.0950247,15.0870594 L13.9848068,18.9768415 L14.1878486,18.7737996 L14.2030419,18.7889929 L17.6549753,15.3370594 L24.9498374,22.6319215 Z M2.00810114,21.0526627 C2.00273908,20.9929669 2,20.9325153 2,20.871424 L2,7.12857603 C2,7.08414302 2.00144896,7.04004843 2.00430222,6.99633695 L9.03436454,14.0263993 L2.00810114,21.0526627 Z"></path>
        </svg>
    </a>
    

    
    <a class="social-icon" href="https://eoriented.github.io/index.xml" target="_blank" rel="noopener" type="application/rss+xml" title="Rss">
        <svg width="28px" height="28px" viewBox="0 0 8 8" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <circle xmlns="http://www.w3.org/2000/svg" class="symbol" cx="2" cy="6" r="1"/>
            <path xmlns="http://www.w3.org/2000/svg" class="symbol" d="m 1,4 a 3,3 0 0 1 3,3 h 1 a 4,4 0 0 0 -4,-4 z"/>
            <path xmlns="http://www.w3.org/2000/svg" class="symbol" d="m 1,2 a 5,5 0 0 1 5,5 h 1 a 6,6 0 0 0 -6,-6 z"/>
        </svg>
    </a>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    
    

    
</div>




	
		
		
		
	

	<script src="https://eoriented.github.io/js/main.min.fa5c2b23e07b5d9bfad267a52b4b24fdb053e6fb7524993383594926a3ac270c.js" integrity="sha256-+lwrI+B7XZv60melK0sk/bBT5vt1JJkzg1lJJqOsJww="></script>
</footer>
    </body>
</html>